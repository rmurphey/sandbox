/*******************************************************************************
 *
 *  Copyright (c)  2011 Toura, LLC.	All Rights Reserved.
 *  http://toura.com
 *
 *  LICENSE: https://github.com/Toura/mulberry/blob/master/LICENSE.txt
 *
 *******************************************************************************/
dojo.provide("mulberry.base");if(!dojo._hasResource["mulberry.app.Config"]){dojo._hasResource["mulberry.app.Config"]=true;dojo.provide("mulberry.app.Config");(function(d,_1){var _2={};mulberry.app.Config={get:function(_3){return _2[_3];},set:function(_4,_5){_2=_2||{};_2[_4]=_5;},registerConfig:function(_6){_2=_6||{};}};if(mulberry._Config){mulberry.app.Config.registerConfig(mulberry._Config);}}(dojo));}if(!dojo._hasResource["mulberry.Device"]){dojo._hasResource["mulberry.Device"]=true;dojo.provide("mulberry.Device");mulberry._loadDeviceConfig=function(){function _7(){var _8=dojo.body(),_9=Math.min(_8.offsetWidth,_8.offsetHeight);return _9>640?"tablet":"phone";};mulberry.Device=mulberry.app.Config.get("device")||{type:_7(),os:"browser"};};mulberry._loadDeviceConfig();}if(!dojo._hasResource["mulberry._Logging"]){dojo._hasResource["mulberry._Logging"]=true;dojo.provide("mulberry._Logging");(function(d,w,c){var _a,_b="=====",_c;function _d(ts){var _e="";if(!_c){_c=ts;}else{_e=" ("+(ts-_c)+"ms since last log) ";_c=ts;}return _e;};d.mixin(mulberry,{log:function(){var _f=[].slice.call(arguments);if(w.device){console.log("\n\n "+new Date().getTime()+" "+_f.join(" ")+"\n\n");}else{c.log.apply(c,_f);}},logSection:function(_10){var ts=new Date().getTime();console.log((w.device?"\n":"")+_b+"\n"+ts+"   START "+_10+_d(ts)+"\n"+_b);},endLogSection:function(_11){var ts=new Date().getTime();console.log((w.device?"\n":"")+_b+"\n"+ts+"   END   "+_11+_d(ts)+"\n"+_b);}});}(dojo,window,console));}if(!dojo._hasResource["mulberry._PageDef"]){dojo._hasResource["mulberry._PageDef"]=true;dojo.provide("mulberry._PageDef");mulberry.pageDefs=mulberry.pageDefs||{};dojo.declare("mulberry._PageDef",null,{constructor:function(_12){if(!_12.screens||!_12.screens.length){throw "Page definition must include at least one screen";}dojo.forEach(_12.screens,function(_13){if(!_13.regions||!_13.regions.length){throw "Page definition must include at least one region per screen";}});dojo.mixin(this,_12);}});mulberry.pageDef=function(_14,_15){mulberry.pageDefs[_14]=new mulberry._PageDef(_15);};}if(!dojo._hasResource["dojo.store.util.QueryResults"]){dojo._hasResource["dojo.store.util.QueryResults"]=true;dojo.provide("dojo.store.util.QueryResults");dojo.getObject("store.util",true,dojo);dojo.store.util.QueryResults=function(_16){if(!_16){return _16;}if(_16.then){_16=dojo.delegate(_16);}function _17(_18){if(!_16[_18]){_16[_18]=function(){var _19=arguments;return dojo.when(_16,function(_1a){Array.prototype.unshift.call(_19,_1a);return dojo.store.util.QueryResults(dojo[_18].apply(dojo,_19));});};}};_17("forEach");_17("filter");_17("map");if(!_16.total){_16.total=dojo.when(_16,function(_1b){return _1b.length;});}return _16;};}if(!dojo._hasResource["dojo.store.util.SimpleQueryEngine"]){dojo._hasResource["dojo.store.util.SimpleQueryEngine"]=true;dojo.provide("dojo.store.util.SimpleQueryEngine");dojo.getObject("store.util",true,dojo);dojo.store.util.SimpleQueryEngine=function(_1c,_1d){switch(typeof _1c){default:throw new Error("Can not query with a "+typeof _1c);case "object":case "undefined":var _1e=_1c;_1c=function(_1f){for(var key in _1e){var _20=_1e[key];if(_20&&_20.test){if(!_20.test(_1f[key])){return false;}}else{if(_20!=_1f[key]){return false;}}}return true;};break;case "string":if(!this[_1c]){throw new Error("No filter function "+_1c+" was found in store");}_1c=this[_1c];case "function":}function _21(_22){var _23=dojo.filter(_22,_1c);if(_1d&&_1d.sort){_23.sort(function(a,b){for(var _24,i=0;_24=_1d.sort[i];i++){var _25=a[_24.attribute];var _26=b[_24.attribute];if(_25!=_26){return !!_24.descending==_25>_26?-1:1;}}return 0;});}if(_1d&&(_1d.start||_1d.count)){var _27=_23.length;_23=_23.slice(_1d.start||0,(_1d.start||0)+(_1d.count||Infinity));_23.total=_27;}return _23;};_21.matches=_1c;return _21;};}if(!dojo._hasResource["dojo.store.Memory"]){dojo._hasResource["dojo.store.Memory"]=true;dojo.provide("dojo.store.Memory");dojo.declare("dojo.store.Memory",null,{constructor:function(_28){this.index={};dojo.mixin(this,_28);this.setData(this.data||[]);},data:null,idProperty:"id",index:null,queryEngine:dojo.store.util.SimpleQueryEngine,get:function(id){return this.index[id];},getIdentity:function(_29){return _29[this.idProperty];},put:function(_2a,_2b){var id=_2b&&_2b.id||_2a[this.idProperty]||Math.random();this.index[id]=_2a;var _2c=this.data,_2d=this.idProperty;for(var i=0,l=_2c.length;i<l;i++){if(_2c[i][_2d]==id){_2c[i]=_2a;return id;}}this.data.push(_2a);return id;},add:function(_2e,_2f){if(this.index[_2f&&_2f.id||_2e[this.idProperty]]){throw new Error("Object already exists");}return this.put(_2e,_2f);},remove:function(id){delete this.index[id];var _30=this.data,_31=this.idProperty;for(var i=0,l=_30.length;i<l;i++){if(_30[i][_31]==id){_30.splice(i,1);return;}}},query:function(_32,_33){return dojo.store.util.QueryResults(this.queryEngine(_32,_33)(this.data));},setData:function(_34){if(_34.items){this.idProperty=_34.identifier;_34=this.data=_34.items;}else{this.data=_34;}for(var i=0,l=_34.length;i<l;i++){var _35=_34[i];this.index[_35[this.idProperty]]=_35;}}});}if(!dojo._hasResource["mulberry._Store"]){dojo._hasResource["mulberry._Store"]=true;dojo.provide("mulberry._Store");dojo.declare("mulberry._Store",dojo.store.Memory,{add:function(_36){_36=this._createModel(_36);this.put(_36);},get:function(id){var _37=this.inherited(arguments);return this._createModel(_37);},put:function(_38){this.inherited(arguments);this._save();},remove:function(id){this.inherited(arguments);this._save();},query:function(_39,_3a){var _3b=_39?this.inherited(arguments):dojo.store.util.QueryResults(this.data);return _3b.map(dojo.hitch(this,"_createModel"));},setData:function(_3c){this.inherited(arguments);this._save();},prepareData:function(_3d){return _3d;},process:function(_3e){_3e=this.prepareData(_3e);if(this.model&&client.models[this.model]){_3e=this._createModels(_3e);}return _3e;},invoke:function(ids,fn){ids=dojo.isArray(ids)?ids:[ids];var _3f=dojo.map(ids,function(id){var _40=this.get(id);dojo.hitch(_40,fn)(_40);this.put(_40);return _40;},this);return dojo.store.util.QueryResults(_3f);},_createModel:function(_41){if(this.model&&client.models[this.model]){_41=new client.models[this.model](_41);_41.format();}else{console.warn("No model for "+this.declaredClass);}if(!_41.id){_41.id=this._createId();}return _41;},_createModels:function(_42){return dojo.map(_42,dojo.hitch(this,"_createModel"));},_save:function(){mulberry.app.DeviceStorage.set(this.key,this.data);},_createId:function(){return (((1+Math.random())*65536)).toString(16).substring(1);}});mulberry.store=function(_43,_44){dojo.declare("client.stores."+_43,mulberry._Store,dojo.mixin({key:_43,data:mulberry.app.DeviceStorage.get(_43)},_44));client.stores[_43]=new client.stores[_43]();};}if(!dojo._hasResource["mulberry._Model"]){dojo._hasResource["mulberry._Model"]=true;dojo.provide("mulberry._Model");dojo.declare("mulberry._Model",dojo.Stateful,{format:function(){}});mulberry.model=function(_45,_46){dojo.declare("client.models."+_45,mulberry._Model,_46);};}if(!dojo._hasResource["mulberry._Capability"]){dojo._hasResource["mulberry._Capability"]=true;dojo.provide("mulberry._Capability");dojo.declare("mulberry._Capability",null,{requirements:{},connects:[],constructor:function(_47){dojo.mixin(this,_47);this.domNode=this.page.domNode;this.node=this.page.node;this.involved=this._loadInvolvedComponents();if(!this._checkRequirements()){console.error("Did not find required components for capability",this.declaredClass);console.error("These are the components I know about",this.involved);throw ("Did not find required components for capability "+this.declaredClass);}this._doLookups();this._doConnects();this.init();},init:function(){},_loadInvolvedComponents:function(){var _48={};dojo.forEach(this.components||[],function(c){var tmp=c.split(":"),_49=tmp[0],_4a=tmp[1],_4b=this.page.getScreen(_49),_4c=_4b.getComponent(_4a);if(!_4c){console.error("Capability",this.declaredClass,"did not find component for",_4a,"on the",_49,"screen");}_48[_4a]=_4c;},this);return _48;},_checkRequirements:function(){var _4d=true;dojo.forIn(this.requirements,function(_4e,_4f){var _50=!!this.involved[_4f]||this.page.getComponent(_4f);_4d=_4d&&_50;if(!_50){console.warn("did not find",_4f);}},this);return _4d;},_doLookups:function(){dojo.forIn(this.requirements,function(_51,_52){this[_51]=this.involved[_52]||this.page.getComponent(_52);},this);},_doConnects:function(){dojo.forEach(this.connects,function(c){this.connect.apply(this,c);},this);},connect:function(obj,_53,fn){if(dojo.isString(obj)){obj=this[obj];}this.page.connect(obj,_53,dojo.hitch(this,fn));}});mulberry.capability=function(_54,_55){dojo.declare("mulberry.capabilities."+_54,mulberry._Capability,_55);};}if(!dojo._hasResource["mulberry.Utilities"]){dojo._hasResource["mulberry.Utilities"]=true;dojo.provide("mulberry.Utilities");dojo.forIn=function(obj,fn,_56){var k;for(k in obj){if(obj.hasOwnProperty(k)){dojo.hitch(_56||window,fn)(k,obj[k]);}}};mulberry.util={truncate:function(_57,len){var _58;len=len||200;_57=_57.replace("</p>"," ").replace("<br>"," ").replace(/(<\/.>)|(<.>)|(<[^b][^r]?[^>]*>)/g,"");_58=_57=dojo.trim(_57);_57=_57.substr(0,len);if(_57&&_58.length>len){_57=_57+" &hellip;";}return _57;},copyStyles:function(_59,_5a,_5b){var _5c=window.getComputedStyle(_59);dojo.forEach(_5b,function(_5d){dojo.style(_5a,_5d,_5c[_5d]);});}};mulberry.tmpl=function(str,_5e){return dojo.string.substitute(str,_5e);};mulberry.haml=Haml;mulberry.jsonp=function(url,_5f){_5f=dojo.isObject(url)?url:(_5f||{});_5f.callbackParamName=_5f.callback||_5f.callbackParamName||"callback";url=dojo.isString(url)?url:_5f.url;if(!url){return;}return dojo.io.script.get(dojo.delegate(_5f,{url:url}));};mulberry.page=function(_60,_61,_62){mulberry.route(_60,function(_63){mulberry.showPage(mulberry.createPage(dojo.mixin(_61,{params:_63})));},_62);};}if(!dojo._hasResource["mulberry.app.URL"]){dojo._hasResource["mulberry.app.URL"]=true;dojo.provide("mulberry.app.URL");mulberry.app.URL={protocol:function(){return (/^https/).test(document.location.protocol)?"https":"http";},tel:function(tel){return "tel:"+tel.replace(/\W/g,"");},googleMapAddress:function(_64){var url="http://maps.google.com/maps?",_65={q:_64};return url+dojo.objectToQuery(_65);}};}if(!dojo._hasResource["mulberry.app.PhoneGap.notification"]){dojo._hasResource["mulberry.app.PhoneGap.notification"]=true;dojo.provide("mulberry.app.PhoneGap.notification");mulberry.app.PhoneGap.notification=function(pg,_66){return {alert:function(msg){if(pg){navigator.notification.alert(msg);}else{alert(msg);}}};};}if(!dojo._hasResource["mulberry.app.PhoneGap.device"]){dojo._hasResource["mulberry.app.PhoneGap.device"]=true;dojo.provide("mulberry.app.PhoneGap.device");(function(){function _67(ua){if(!ua){return "unknown";}if(!dojo.isString(ua)){return "unknown";}if(!dojo.trim(ua)){return "unknown";}var v;if(ua.match("Android")){v=dojo.trim(ua.split("Android")[1].split(";")[0]).split("-")[0].split(".");return _68(v);}if(ua.indexOf("AppleWebKit")>-1&&(ua.indexOf("iPhone")+ua.indexOf("iPad")+ua.indexOf("iPod"))>=0){return "unknown-ios-webkit";}return "unknown";};function _68(_69){return [_69[0],_69[1]||"0"].join("-");};mulberry.app.PhoneGap.device=function(pg,_6a){return {version:(function(){if(pg){return _68(window.device.version.split("-")[0].split("."));}return _67(window.navigator.userAgent);}()),_parseVersion:_67};};}());}if(!dojo._hasResource["mulberry.app.PhoneGap.network"]){dojo._hasResource["mulberry.app.PhoneGap.network"]=true;dojo.provide("mulberry.app.PhoneGap.network");mulberry.app.PhoneGap.network=function(pg,_6b){var n=navigator,_6c=5*60*1000,_6d,_6e,_6f;return {isReachable:function(){console.log("mulberry.app.PhoneGap.network::isReachable()");var dfd=new dojo.Deferred(),now=new Date().getTime();if(_6e&&!_6f&&(now-_6e<_6c)){dfd.resolve(_6f);return dfd;}_6e=now;if(navigator.network&&navigator.network.connection){_6d=navigator.network.connection.type;if(_6d===Connection.UNKNOWN||_6d===Connection.NONE){_6f=false;}else{_6f=true;}}else{_6f=true;}dfd.resolve(_6f);return dfd.promise;},state:function(){var _70={},_71;if(navigator.network&&navigator.network.connection){_70[Connection.UNKNOWN]="Unknown connection";_70[Connection.ETHERNET]="Ethernet connection";_70[Connection.WIFI]="WiFi connection";_70[Connection.CELL_2G]="Cell 2G connection";_70[Connection.CELL_3G]="Cell 3G connection";_70[Connection.CELL_4G]="Cell 4G connection";_70[Connection.NONE]="No network connection";_71=navigator.network.connection.type;return {state:_71,description:_70[_71]};}else{return {state:-1,description:"Unknown connection"};}}};};}if(!dojo._hasResource["mulberry.app.PhoneGap.audio"]){dojo._hasResource["mulberry.app.PhoneGap.audio"]=true;dojo.provide("mulberry.app.PhoneGap.audio");mulberry.app.PhoneGap.audio=function(pg,_72){var _73,_74=function(){},_75=function(err){};return {play:function(url){console.log("mulberry.app.PhoneGap.audio::play()");if(!pg){return;}url=/^http/.test(url)?url:("/android_asset/www/"+url);_73=new Media(url,_74,_75);_73.play();},stop:function(){console.log("mulberry.app.PhoneGap.audio::stop()");if(!pg||!_73){return;}_73.pause();},destroy:function(){if(!_73){return;}_73.stop();_73.release();_73=null;}};};}if(!dojo._hasResource["vendor.urbanairship.push"]){dojo._hasResource["vendor.urbanairship.push"]=true;dojo.provide("vendor.urbanairship.push");vendor.urbanairship.push=function(){var _76=function(){};_76.prototype.register=function(_77,_78,_79){PhoneGap.exec(_77,_78,"PushNotification","registerAPN",_79);};_76.prototype.startNotify=function(_7a){PhoneGap.exec(null,null,"PushNotification","startNotify",[]);};_76.prototype.log=function(_7b){PhoneGap.exec(null,null,"PushNotification","log",[{"msg":_7b}]);};PhoneGap.addConstructor(function(){if(!window.plugins){window.plugins={};}window.plugins.pushNotification=new _76();});};}if(!dojo._hasResource["mulberry.app.PhoneGap.push"]){dojo._hasResource["mulberry.app.PhoneGap.push"]=true;dojo.provide("mulberry.app.PhoneGap.push");mulberry.app.PhoneGap.push=function(pg,_7c){if(!pg){return;}vendor.urbanairship.push();};}if(!dojo._hasResource["mulberry.app.PhoneGap.browser"]){dojo._hasResource["mulberry.app.PhoneGap.browser"]=true;dojo.provide("mulberry.app.PhoneGap.browser");mulberry.app.PhoneGap.browser=function(pg,_7d){function _7e(){};window.ChildBrowser=_7e;var os=_7d.os,_7f={ios:function(){_7e._onLocationChange=function(_80){window.plugins.childBrowser.onLocationChange(_80);};_7e._onClose=function(){window.plugins.childBrowser.onClose();};_7e._onOpenExternal=function(){window.plugins.childBrowser.onOpenExternal();};_7e._onJSCallback=function(js,loc){};_7e.prototype.showWebPage=function(loc){PhoneGap.exec("ChildBrowserCommand.showWebPage",loc);};_7e.prototype.close=function(){PhoneGap.exec("ChildBrowserCommand.close");};_7e.prototype.jsExec=function(_81){};_7e.install=function(){if(!window.plugins){window.plugins={};}window.plugins.childBrowser=new _7e();return window.plugins.childBrowser;};_7e.install();},android:function(){_7e.prototype.showWebPage=function(url,_82){PhoneGap.exec(null,null,"ChildBrowser","showWebPage",[url,_82]);};PhoneGap.addConstructor(function(){PhoneGap.addPlugin("childBrowser",new _7e());PluginManager.addService("ChildBrowser","com.phonegap.plugins.childBrowser.ChildBrowser");});}};if(pg&&_7f[os]){_7f[os]();}return {url:function(url){if(pg){if(os==="android"){PhoneGap.exec(null,null,"ChildBrowser","showWebPage",[url,false]);}else{window.plugins.childBrowser.showWebPage(url);}return;}window.location=url;},getBrowser:function(){if(!window.plugins.childBrowser){throw new Error("Can't find childBrowser plugin");}return window.plugins.childBrowser;}};};}if(!dojo._hasResource["mulberry.app.PhoneGap.camera"]){dojo._hasResource["mulberry.app.PhoneGap.camera"]=true;dojo.provide("mulberry.app.PhoneGap.camera");mulberry.app.PhoneGap.camera=function(pg,_83){var _84=function(){};return {getPicture:function(_85,_86,_87){if(!dojo.isFunction(_85)){_87=_85;_85=false;_86=false;}var dfd=new dojo.Deferred(),win=function(_88){(_85||_84)(_88);dfd.resolve(_88);},_89=function(msg){(_86||_84)(msg);dfd.reject(msg);};if(pg&&navigator&&navigator.camera){navigator.camera.getPicture(win,_89,_87);}else{dfd.resolve();}return dfd.promise;}};};}if(!dojo._hasResource["mulberry.app.PhoneGap.geolocation"]){dojo._hasResource["mulberry.app.PhoneGap.geolocation"]=true;dojo.provide("mulberry.app.PhoneGap.geolocation");mulberry.app.PhoneGap.geolocation=function(pg,_8a){var _8b=function(){};return {getCurrentPosition:function(_8c,_8d,_8e){if(!dojo.isFunction(_8c)){_8e=_8c;_8c=false;_8d=false;}var dfd=new dojo.Deferred(),win=function(_8f){(_8c||_8b)(_8f);dfd.resolve(_8f);},_90=function(msg){(_8d||_8b)(msg);dfd.reject(msg);},_91="Geolocation API not available";if(navigator.geolocation&&navigator.geolocation.getCurrentPosition){navigator.geolocation.getCurrentPosition(win,_90,_8e);}else{_90(_91);}return dfd.promise;},watchPosition:function(_92,_93,_94){if(navigator.geolocation&&navigator.geolocation.watchPosition){return navigator.geolocation.watchPosition(_92,_93,_94);}return false;},clearWatch:function(_95){if(_95&&navigator.geolocation&&navigator.geolocation.clearWatch){navigator.geolocation.clearWatch(_95);}}};};}if(!dojo._hasResource["mulberry.app.PhoneGap.accelerometer"]){dojo._hasResource["mulberry.app.PhoneGap.accelerometer"]=true;dojo.provide("mulberry.app.PhoneGap.accelerometer");mulberry.app.PhoneGap.accelerometer=function(pg,_96){var _97=function(){};return {getCurrentAcceleration:function(_98,_99){var dfd=new dojo.Deferred(),win=function(_9a){(_98||_97)(_9a);dfd.resolve(_9a);},_9b=function(msg){(_99||_97)(msg);dfd.reject(msg);},_9c="Accelerometer API not available";if(navigator.accelerometer&&navigator.accelerometer.getCurrentAcceleration){navigator.accelerometer.getCurrentAcceleration(win,_9b);}else{_9b(_9c);}return dfd.promise;},watchAcceleration:function(_9d,_9e){if(navigator.accelerometer&&navigator.accelerometer.watchAcceleration){return navigator.accelerometer.watchAcceleration(_9d,_9e);}else{return false;}},clearWatch:function(_9f){var _a0=_9f.watchId||_9f;if(navigator.accelerometer&&navigator.accelerometer.clearWatch&&_a0){navigator.accelerometer.clearWatch(_a0);}}};};}if(!dojo._hasResource["mulberry.app.PhoneGap"]){dojo._hasResource["mulberry.app.PhoneGap"]=true;dojo.provide("mulberry.app.PhoneGap");(function(){mulberry.app.PhoneGap.registerAPI=function(_a1,_a2){var s=dojo.subscribe("/app/deviceready",function(){var _a3=mulberry.Device,_a4=mulberry.app.PhoneGap.present=window.device&&window.device.phonegap;console.log("NAME",_a1);mulberry.app.PhoneGap[_a1]=_a2(_a4,_a3);dojo.unsubscribe(s);});};var _a5=["notification","device","network","audio","push","browser","camera","geolocation","accelerometer"];dojo.forEach(_a5,function(_a6){mulberry.app.PhoneGap.registerAPI(_a6,mulberry.app.PhoneGap[_a6]);});}());}if(!dojo._hasResource["mulberry.app.DeviceStorage"]){dojo._hasResource["mulberry.app.DeviceStorage"]=true;dojo.provide("mulberry.app.DeviceStorage");mulberry.app.DeviceStorage=(function(){var _a7={"tour":{tableName:"items",fields:["id text","json text"],insertStatement:function(_a8,_a9){return ["INSERT INTO "+_a8+"( id, json ) VALUES ( ?, ? )",[_a9.id,JSON.stringify(_a9)]];},processSelecton:function(_aa){var _ab=[],len=_aa.rows.length,_ac,i;for(i=0;i<len;i++){_ac=_aa.rows.item(i).json;_ab.push(_ac?JSON.parse(_ac):{});}return _ab;}}};return {init:function(_ad){this.appId=_ad;if(!window.localStorage){throw new Error("Local storage interface is not defined. Cannot create database. Aborting.");}if(!window.openDatabase){throw new Error("SQLite database interface is not defined. Cannot create database. Aborting.");}var db=this._db=openDatabase(_ad+"-"+mulberry.version,"1.0",_ad+" Database",5*1024*1024);if(!db){console.log("No database. This will end badly.");}this._sql=function(_ae,_af){var dfd=new dojo.Deferred(),len;_ae=dojo.isArray(_ae)?_ae:[_ae];len=_ae.length;db.transaction(function(t){dojo.forEach(_ae,function(q,i){var _b0=i+1===len,cb,eb,_b1=[];if(_b0){cb=dojo.isFunction(_af)?function(t,_b2){dfd.callback(_af(_b2));}:dfd.callback;eb=dfd.errback;}else{cb=eb=function(){};}if(dojo.isArray(q)){_b1=q[1];q=q[0];}t.executeSql(q,_b1,cb,eb);});});return dfd;};return this._db;},drop:function(){var _b3=[];dojo.forIn(_a7,function(_b4,_b5){_b3.push("DROP TABLE IF EXISTS "+_b5.tableName);});window.localStorage.clear();return this._sql&&this._sql(_b3);},set:function(k,v){var sql=_a7[k],_b6;if(sql){_b6=["DROP TABLE IF EXISTS "+sql.tableName,"CREATE TABLE "+sql.tableName+"("+sql.fields.join(",")+")"];dojo.forEach(v,function(_b7){_b6.push(sql.insertStatement(sql.tableName,_b7));});return this._sql(_b6);}window.localStorage.setItem(k,JSON.stringify(v));return true;},get:function(k){var sql=_a7[k];if(sql){return this._sql("SELECT * FROM "+sql.tableName,sql.processSelecton);}var ret=window.localStorage.getItem(k);if(ret==="undefined"){ret=null;}ret=ret&&JSON.parse(ret);return ret;}};}());}if(!dojo._hasResource["mulberry._Nls"]){dojo._hasResource["mulberry._Nls"]=true;dojo.provide("mulberry._Nls");dojo.declare("mulberry._Nls",null,{data:{__initialized:false},constructor:function(){if(!this.data.__initialized){this.data.nlsStrings=dojo.i18n.getLocalization("mulberry","mulberry",mulberry.app.Config.get("locale"));this.data.__initialized=true;}},getString:function(key,_b8){var str=this.data.nlsStrings[key];return (_b8)?dojo.string.substitute(str,_b8):str;},postMixInProperties:function(){this.inherited("postMixInProperties",arguments);this.initializeStrings();},initializeStrings:function(){}});}if(!dojo._hasResource["vendor.iscroll"]){dojo._hasResource["vendor.iscroll"]=true;dojo.provide("vendor.iscroll");(function(){function _b9(el,_ba){var _bb=this,doc=document,div,i;_bb.wrapper=typeof el=="object"?el:doc.getElementById(el);_bb.wrapper.style.overflow="hidden";_bb.scroller=_bb.wrapper.children[0];_bb.options={HWTransition:true,HWCompositing:true,hScroll:true,vScroll:true,hScrollbar:true,vScrollbar:true,fixedScrollbar:_bc,fadeScrollbar:(_bd&&_be)||!_bf,hideScrollbar:_bd||!_bf,scrollbarClass:"",bounce:_be,bounceLock:false,momentum:_be,lockDirection:true,zoom:false,zoomMin:1,zoomMax:4,snap:false,pullToRefresh:false,pullDownLabel:["Pull down to refresh...","Release to refresh...","Loading..."],pullUpLabel:["Pull up to refresh...","Release to refresh...","Loading..."],onPullDown:function(){},onPullUp:function(){},onScrollStart:null,onScrollEnd:null,onZoomStart:null,onZoomEnd:null,checkDOMChange:false};for(i in _ba){_bb.options[i]=_ba[i];}_bb.options.HWCompositing=_bb.options.HWCompositing&&_112;_bb.options.HWTransition=_bb.options.HWTransition&&_112;if(_bb.options.HWCompositing){_bb.scroller.style.cssText+="-webkit-transition-property:-webkit-transform;-webkit-transform-origin:0 0;-webkit-transform:"+_c7+"0,0"+_c8;}else{_bb.scroller.style.cssText+="-webkit-transition-property:top,left;-webkit-transform-origin:0 0;top:0;left:0";}if(_bb.options.HWTransition){_bb.scroller.style.cssText+="-webkit-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);-webkit-transition-duration:0;";}_bb.options.hScrollbar=_bb.options.hScroll&&_bb.options.hScrollbar;_bb.options.vScrollbar=_bb.options.vScroll&&_bb.options.vScrollbar;_bb.pullDownToRefresh=_bb.options.pullToRefresh=="down"||_bb.options.pullToRefresh=="both";_bb.pullUpToRefresh=_bb.options.pullToRefresh=="up"||_bb.options.pullToRefresh=="both";if(_bb.pullDownToRefresh){div=doc.createElement("div");div.className="iScrollPullDown";div.innerHTML="<span class=\"iScrollPullDownIcon\"></span><span class=\"iScrollPullDownLabel\">"+_bb.options.pullDownLabel[0]+"</span>\n";_bb.scroller.insertBefore(div,_bb.scroller.children[0]);_bb.options.bounce=true;_bb.pullDownEl=div;_bb.pullDownLabel=div.getElementsByTagName("span")[1];}if(_bb.pullUpToRefresh){div=doc.createElement("div");div.className="iScrollPullUp";div.innerHTML="<span class=\"iScrollPullUpIcon\"></span><span class=\"iScrollPullUpLabel\">"+_bb.options.pullUpLabel[0]+"</span>\n";_bb.scroller.appendChild(div);_bb.options.bounce=true;_bb.pullUpEl=div;_bb.pullUpLabel=div.getElementsByTagName("span")[1];}_bb.refresh();_bb._bind(_c5,window);_bb._bind(_c1);if(_d5&&_bb.options.zoom){_bb._bind("gesturestart");_bb.scroller.style.webkitTransform=_bb.scroller.style.webkitTransform+" scale(1)";}if(!_bf){_bb._bind("mousewheel");}if(_bb.options.checkDOMChange){_bb.DOMChangeInterval=setInterval(function(){_bb._checkSize();},250);}};_b9.prototype={x:0,y:0,currPageX:0,currPageY:0,pagesX:[],pagesY:[],offsetBottom:0,offsetTop:0,scale:1,lastScale:1,contentReady:true,handleEvent:function(e){var _c0=this;switch(e.type){case _c1:_c0._start(e);break;case _c2:_c0._move(e);break;case _c3:case _c4:_c0._end(e);break;case "webkitTransitionEnd":_c0._transitionEnd(e);break;case _c5:_c0._resize();break;case "gesturestart":_c0._gestStart(e);break;case "gesturechange":_c0._gestChange(e);break;case "gestureend":case "gesturecancel":_c0._gestEnd(e);break;case "mousewheel":_c0._wheel(e);break;}},_scrollbar:function(dir){var _c6=this,doc=document,bar;if(!_c6[dir+"Scrollbar"]){if(_c6[dir+"ScrollbarWrapper"]){_c6[dir+"ScrollbarIndicator"].style.webkitTransform="";_c6[dir+"ScrollbarWrapper"].parentNode.removeChild(_c6[dir+"ScrollbarWrapper"]);_c6[dir+"ScrollbarWrapper"]=null;_c6[dir+"ScrollbarIndicator"]=null;}return;}if(!_c6[dir+"ScrollbarWrapper"]){bar=doc.createElement("div");if(_c6.options.scrollbarClass){bar.className=_c6.options.scrollbarClass+dir.toUpperCase();}else{bar.style.cssText="position:absolute;z-index:100;"+(dir=="h"?"height:7px;bottom:1px;left:2px;right:7px":"width:7px;bottom:7px;top:2px;right:1px");}bar.style.cssText+="pointer-events:none;-webkit-transition-property:opacity;-webkit-transition-duration:"+(_c6.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(_c6.options.hideScrollbar?"0":"1");_c6.wrapper.appendChild(bar);_c6[dir+"ScrollbarWrapper"]=bar;bar=doc.createElement("div");if(!_c6.options.scrollbarClass){bar.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);-webkit-background-clip:padding-box;-webkit-box-sizing:border-box;"+(dir=="h"?"height:100%;-webkit-border-radius:4px 3px;":"width:100%;-webkit-border-radius:3px 4px;");}bar.style.cssText+="pointer-events:none;-webkit-transition-property:-webkit-transform;-webkit-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);-webkit-transition-duration:0;-webkit-transform:"+_c7+"0,0"+_c8;_c6[dir+"ScrollbarWrapper"].appendChild(bar);_c6[dir+"ScrollbarIndicator"]=bar;}if(dir=="h"){_c6.hScrollbarSize=_c6.hScrollbarWrapper.clientWidth;_c6.hScrollbarIndicatorSize=m.max(m.round(_c6.hScrollbarSize*_c6.hScrollbarSize/_c6.scrollerW),8);_c6.hScrollbarIndicator.style.width=_c6.hScrollbarIndicatorSize+"px";_c6.hScrollbarMaxScroll=_c6.hScrollbarSize-_c6.hScrollbarIndicatorSize;_c6.hScrollbarProp=_c6.hScrollbarMaxScroll/_c6.maxScrollX;}else{_c6.vScrollbarSize=_c6.vScrollbarWrapper.clientHeight;_c6.vScrollbarIndicatorSize=m.max(m.round(_c6.vScrollbarSize*_c6.vScrollbarSize/_c6.scrollerH),8);_c6.vScrollbarIndicator.style.height=_c6.vScrollbarIndicatorSize+"px";_c6.vScrollbarMaxScroll=_c6.vScrollbarSize-_c6.vScrollbarIndicatorSize;_c6.vScrollbarProp=_c6.vScrollbarMaxScroll/_c6.maxScrollY;}_c6._indicatorPos(dir,true);},_resize:function(){var _c9=this;setTimeout(function(){_c9.refresh();},0);},_checkSize:function(){var _ca=this,_cb,_cc;if(_ca.moved||_ca.zoomed||!_ca.contentReady){return;}_cb=m.round(_ca.scroller.offsetWidth*_ca.scale),_cc=m.round((_ca.scroller.offsetHeight-_ca.offsetBottom-_ca.offsetTop)*_ca.scale);if(_cb==_ca.scrollerW&&_cc==_ca.scrollerH){return;}_ca.refresh();},_pos:function(x,y){var _cd=this;_cd.x=_cd.hScroll?x:0;_cd.y=_cd.vScroll?y:0;_cd.scroller.style.webkitTransform=_c7+_cd.x+"px,"+_cd.y+"px"+_c8+" scale("+_cd.scale+")";_cd._indicatorPos("h");_cd._indicatorPos("v");},_indicatorPos:function(dir,_ce){var _cf=this,pos=dir=="h"?_cf.x:_cf.y;if(!_cf[dir+"Scrollbar"]){return;}pos=_cf[dir+"ScrollbarProp"]*pos;if(pos<0){pos=_cf.options.fixedScrollbar?0:pos+pos*3;if(_cf[dir+"ScrollbarIndicatorSize"]+pos<9){pos=-_cf[dir+"ScrollbarIndicatorSize"]+8;}}else{if(pos>_cf[dir+"ScrollbarMaxScroll"]){pos=_cf.options.fixedScrollbar?_cf[dir+"ScrollbarMaxScroll"]:pos+(pos-_cf[dir+"ScrollbarMaxScroll"])*3;if(_cf[dir+"ScrollbarIndicatorSize"]+_cf[dir+"ScrollbarMaxScroll"]-pos<9){pos=_cf[dir+"ScrollbarIndicatorSize"]+_cf[dir+"ScrollbarMaxScroll"]-8;}}}_cf[dir+"ScrollbarWrapper"].style.webkitTransitionDelay="0";_cf[dir+"ScrollbarWrapper"].style.opacity=_ce&&_cf.options.hideScrollbar?"0":"1";_cf[dir+"ScrollbarIndicator"].style.webkitTransform=_c7+(dir=="h"?pos+"px,0":"0,"+pos+"px")+_c8;},_transitionTime:function(_d0){var _d1=this;_d0+="ms";_d1.scroller.style.webkitTransitionDuration=_d0;if(_d1.hScrollbar){_d1.hScrollbarIndicator.style.webkitTransitionDuration=_d0;}if(_d1.vScrollbar){_d1.vScrollbarIndicator.style.webkitTransitionDuration=_d0;}},_start:function(e){var _d2=this,_d3=_bf?e.changedTouches[0]:e,_d4;_d2.moved=false;e.preventDefault();if(_bf&&e.touches.length==2&&_d2.options.zoom&&_d5&&!_d2.zoomed){_d2.originX=m.abs(e.touches[0].pageX+e.touches[1].pageX-_d2.wrapperOffsetLeft*2)/2-_d2.x;_d2.originY=m.abs(e.touches[0].pageY+e.touches[1].pageY-_d2.wrapperOffsetTop*2)/2-_d2.y;}_d2.moved=false;_d2.distX=0;_d2.distY=0;_d2.absDistX=0;_d2.absDistY=0;_d2.dirX=0;_d2.dirY=0;_d2.returnTime=0;_d2._transitionTime(0);if(_d2.options.momentum){if(_d2.scrollInterval){clearInterval(_d2.scrollInterval);_d2.scrollInterval=null;}if(_d2.options.HWCompositing){_d4=new WebKitCSSMatrix(window.getComputedStyle(_d2.scroller,null).webkitTransform);if(_d4.m41!=_d2.x||_d4.m42!=_d2.y){_d2._unbind("webkitTransitionEnd");_d2._pos(_d4.m41,_d4.m42);}}else{_d4=window.getComputedStyle(_d2.scroller,null);if(_d2.x+"px"!=_d4.left||_d2.y+"px"!=_d4.top){_d2._unbind("webkitTransitionEnd");_d2._pos(_d4.left.replace(/[^0-9]/g)*1,_d4.top.replace(/[^0-9]/g)*1);}}}_d2.scroller.style.webkitTransitionTimingFunction="cubic-bezier(0.33,0.66,0.66,1)";if(_d2.hScrollbar){_d2.hScrollbarIndicator.style.webkitTransitionTimingFunction="cubic-bezier(0.33,0.66,0.66,1)";}if(_d2.vScrollbar){_d2.vScrollbarIndicator.style.webkitTransitionTimingFunction="cubic-bezier(0.33,0.66,0.66,1)";}_d2.startX=_d2.x;_d2.startY=_d2.y;_d2.pointX=_d3.pageX;_d2.pointY=_d3.pageY;_d2.startTime=e.timeStamp;if(_d2.options.onScrollStart){_d2.options.onScrollStart.call(_d2);}_d2._bind(_c2);_d2._bind(_c3);_d2._bind(_c4);},_move:function(e){if(_bf&&e.touches.length>1){return;}var _d6=this,_d7=_bf?e.changedTouches[0]:e,_d8=_d7.pageX-_d6.pointX,_d9=_d7.pageY-_d6.pointY,_da=_d6.x+_d8,_db=_d6.y+_d9;e.preventDefault();_d6.pointX=_d7.pageX;_d6.pointY=_d7.pageY;if(_da>0||_da<_d6.maxScrollX){_da=_d6.options.bounce?_d6.x+(_d8/2.4):_da>=0||_d6.maxScrollX>=0?0:_d6.maxScrollX;}if(_db>0||_db<_d6.maxScrollY){_db=_d6.options.bounce?_d6.y+(_d9/2.4):_db>=0||_d6.maxScrollY>=0?0:_d6.maxScrollY;if(_d6.options.pullToRefresh&&_d6.contentReady){if(_d6.pullDownToRefresh&&_db>_d6.offsetBottom){_d6.pullDownEl.className="iScrollPullDown flip";_d6.pullDownLabel.innerText=_d6.options.pullDownLabel[1];}else{if(_d6.pullDownToRefresh&&_d6.pullDownEl.className.match("flip")){_d6.pullDownEl.className="iScrollPullDown";_d6.pullDownLabel.innerText=_d6.options.pullDownLabel[0];}}if(_d6.pullUpToRefresh&&_db<_d6.maxScrollY-_d6.offsetTop){_d6.pullUpEl.className="iScrollPullUp flip";_d6.pullUpLabel.innerText=_d6.options.pullUpLabel[1];}else{if(_d6.pullUpToRefresh&&_d6.pullUpEl.className.match("flip")){_d6.pullUpEl.className="iScrollPullUp";_d6.pullUpLabel.innerText=_d6.options.pullUpLabel[0];}}}}if(_d6.absDistX<4&&_d6.absDistY<4){_d6.distX+=_d8;_d6.distY+=_d9;_d6.absDistX=m.abs(_d6.distX);_d6.absDistY=m.abs(_d6.distY);return;}if(_d6.options.lockDirection){if(_d6.absDistX>_d6.absDistY+3){_db=_d6.y;_d9=0;}else{if(_d6.absDistY>_d6.absDistX+3){_da=_d6.x;_d8=0;}}}_d6.moved=true;_d6._pos(_da,_db);_d6.dirX=_d8>0?-1:_d8<0?1:0;_d6.dirY=_d9>0?-1:_d9<0?1:0;if(e.timeStamp-_d6.startTime>300){_d6.startTime=e.timeStamp;_d6.startX=_d6.x;_d6.startY=_d6.y;}},_end:function(e){if(_bf&&e.touches.length!=0){return;}var _dc=this,_dd=_bf?e.changedTouches[0]:e,_de,ev,_df={dist:0,time:0},_e0={dist:0,time:0},_e1=e.timeStamp-_dc.startTime,_e2=_dc.x,_e3=_dc.y,_e4,_e5;_dc._unbind(_c2);_dc._unbind(_c3);_dc._unbind(_c4);if(_dc.zoomed){return;}if(!_dc.moved){if(_bf){if(_dc.doubleTapTimer&&_dc.options.zoom){clearTimeout(_dc.doubleTapTimer);_dc.doubleTapTimer=null;_dc.zoom(_dc.pointX,_dc.pointY,_dc.scale==1?2:1);}else{_dc.doubleTapTimer=setTimeout(function(){_dc.doubleTapTimer=null;_de=_dd.target;while(_de.nodeType!=1){_de=_de.parentNode;}ev=document.createEvent("MouseEvents");ev.initMouseEvent("click",true,true,e.view,1,_dd.screenX,_dd.screenY,_dd.clientX,_dd.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null);ev._fake=true;_de.dispatchEvent(ev);},_dc.options.zoom?250:0);}}_dc._resetPos();return;}if(_dc.pullDownToRefresh&&_dc.contentReady&&_dc.pullDownEl.className.match("flip")){_dc.pullDownEl.className="iScrollPullDown loading";_dc.pullDownLabel.innerText=_dc.options.pullDownLabel[2];_dc.scroller.style.marginTop="0";_dc.offsetBottom=0;_dc.refresh();_dc.contentReady=false;_dc.options.onPullDown();}if(_dc.pullUpToRefresh&&_dc.contentReady&&_dc.pullUpEl.className.match("flip")){_dc.pullUpEl.className="iScrollPullUp loading";_dc.pullUpLabel.innerText=_dc.options.pullUpLabel[2];_dc.scroller.style.marginBottom="0";_dc.offsetTop=0;_dc.refresh();_dc.contentReady=false;_dc.options.onPullUp();}if(_e1<300&&_dc.options.momentum){_df=_e2?_dc._momentum(_e2-_dc.startX,_e1,-_dc.x,_dc.scrollerW-_dc.wrapperW+_dc.x,_dc.options.bounce?_dc.wrapperW:0):_df;_e0=_e3?_dc._momentum(_e3-_dc.startY,_e1,-_dc.y,(_dc.maxScrollY<0?_dc.scrollerH-_dc.wrapperH+_dc.y:0),_dc.options.bounce?_dc.wrapperH:0):_e0;_e2=_dc.x+_df.dist;_e3=_dc.y+_e0.dist;if((_dc.x>0&&_e2>0)||(_dc.x<_dc.maxScrollX&&_e2<_dc.maxScrollX)){_df={dist:0,time:0};}if((_dc.y>0&&_e3>0)||(_dc.y<_dc.maxScrollY&&_e3<_dc.maxScrollY)){_e0={dist:0,time:0};}}if(_df.dist||_e0.dist){_e4=m.max(m.max(_df.time,_e0.time),10);if(_dc.options.snap){_e5=_dc._snap(_e2,_e3);_e2=_e5.x;_e3=_e5.y;_e4=m.max(_e5.time,_e4);}_dc.scrollTo(_e2,_e3,_e4);return;}if(_dc.options.snap){_e5=_dc._snap(_dc.x,_dc.y);if(_e5.x!=_dc.x||_e5.y!=_dc.y){_dc.scrollTo(_e5.x,_e5.y,_e5.time);}return;}_dc._resetPos();},_resetPos:function(_e6){var _e7=this,_e8=_e7.x,_e9=_e7.y;if(_e7.x>=0){_e8=0;}else{if(_e7.x<_e7.maxScrollX){_e8=_e7.maxScrollX;}}if(_e7.y>=0||_e7.maxScrollY>0){_e9=0;}else{if(_e7.y<_e7.maxScrollY){_e9=_e7.maxScrollY;}}if(_e8==_e7.x&&_e9==_e7.y){if(_e7.moved){if(_e7.options.onScrollEnd){_e7.options.onScrollEnd.call(_e7);}_e7.moved=false;}if(_e7.zoomed){if(_e7.options.onZoomEnd){_e7.options.onZoomEnd.call(_e7);}_e7.zoomed=false;}if(_e7.hScrollbar&&_e7.options.hideScrollbar){_e7.hScrollbarWrapper.style.webkitTransitionDelay="300ms";_e7.hScrollbarWrapper.style.opacity="0";}if(_e7.vScrollbar&&_e7.options.hideScrollbar){_e7.vScrollbarWrapper.style.webkitTransitionDelay="300ms";_e7.vScrollbarWrapper.style.opacity="0";}return;}if(_e6===undefined){_e6=200;}if(_e6){_e7.scroller.style.webkitTransitionTimingFunction="cubic-bezier(0.33,0.0,0.33,1)";if(_e7.hScrollbar){_e7.hScrollbarIndicator.style.webkitTransitionTimingFunction="cubic-bezier(0.33,0.0,0.33,1)";}if(_e7.vScrollbar){_e7.vScrollbarIndicator.style.webkitTransitionTimingFunction="cubic-bezier(0.33,0.0,0.33,1)";}}_e7.scrollTo(_e8,_e9,_e6);},_timedScroll:function(_ea,_eb,_ec){var _ed=this,_ee=_ed.x,_ef=_ed.y,_f0=(new Date).getTime(),_f1;_ed._transitionTime(0);if(_ed.scrollInterval){clearInterval(_ed.scrollInterval);_ed.scrollInterval=null;}_ed.scrollInterval=setInterval(function(){var now=(new Date).getTime(),_f2,_f3;if(now>=_f0+_ec){clearInterval(_ed.scrollInterval);_ed.scrollInterval=null;_ed._pos(_ea,_eb);_ed._transitionEnd();return;}now=(now-_f0)/_ec-1;_f1=m.sqrt(1-now*now);_f2=(_ea-_ee)*_f1+_ee;_f3=(_eb-_ef)*_f1+_ef;_ed._pos(_f2,_f3);},20);},_transitionEnd:function(e){var _f4=this;if(e){e.stopPropagation();}_f4._unbind("webkitTransitionEnd");_f4._resetPos(_f4.returnTime);_f4.returnTime=0;},_gestStart:function(e){var _f5=this;_f5._transitionTime(0);_f5.lastScale=1;if(_f5.options.onZoomStart){_f5.options.onZoomStart.call(_f5);}_f5._unbind("gesturestart");_f5._bind("gesturechange");_f5._bind("gestureend");_f5._bind("gesturecancel");},_gestChange:function(e){var _f6=this,_f7=_f6.scale*e.scale,x,y,_f8;_f6.zoomed=true;if(_f7<_f6.options.zoomMin){_f7=_f6.options.zoomMin;}else{if(_f7>_f6.options.zoomMax){_f7=_f6.options.zoomMax;}}_f8=_f7/_f6.scale;x=_f6.originX-_f6.originX*_f8+_f6.x;y=_f6.originY-_f6.originY*_f8+_f6.y;_f6.scroller.style.webkitTransform=_c7+x+"px,"+y+"px"+_c8+" scale("+_f7+")";_f6.lastScale=_f8;},_gestEnd:function(e){var _f9=this,_fa=_f9.scale,_fb=_f9.lastScale;_f9.scale=_fa*_fb;if(_f9.scale<_f9.options.zoomMin+0.05){_f9.scale=_f9.options.zoomMin;}else{if(_f9.scale>_f9.options.zoomMax-0.05){_f9.scale=_f9.options.zoomMax;}}_fb=_f9.scale/_fa;_f9.x=_f9.originX-_f9.originX*_fb+_f9.x;_f9.y=_f9.originY-_f9.originY*_fb+_f9.y;_f9.scroller.style.webkitTransform=_c7+_f9.x+"px,"+_f9.y+"px"+_c8+" scale("+_f9.scale+")";setTimeout(function(){_f9.refresh();},0);_f9._bind("gesturestart");_f9._unbind("gesturechange");_f9._unbind("gestureend");_f9._unbind("gesturecancel");},_wheel:function(e){var _fc=this,_fd=_fc.x+e.wheelDeltaX/12,_fe=_fc.y+e.wheelDeltaY/12;if(_fd>0){_fd=0;}else{if(_fd<_fc.maxScrollX){_fd=_fc.maxScrollX;}}if(_fe>0){_fe=0;}else{if(_fe<_fc.maxScrollY){_fe=_fc.maxScrollY;}}_fc.scrollTo(_fd,_fe,0);},_momentum:function(_ff,time,_100,_101,size){var that=this,_102=0.0006,_103=m.abs(_ff)/time,_104=(_103*_103)/(2*_102),_105=0,_106=0;if(_ff>0&&_104>_100){_106=size/(6/(_104/_103*_102));_100=_100+_106;that.returnTime=800/size*_106+100;_103=_103*_100/_104;_104=_100;}else{if(_ff<0&&_104>_101){_106=size/(6/(_104/_103*_102));_101=_101+_106;that.returnTime=800/size*_106+100;_103=_103*_101/_104;_104=_101;}}_104=_104*(_ff<0?-1:1);_105=_103/_102;return {dist:_104,time:m.round(_105)};},_offset:function(el,tree){var left=-el.offsetLeft,top=-el.offsetTop;if(!tree){return {x:left,y:top};}while(el=el.offsetParent){left-=el.offsetLeft;top-=el.offsetTop;}return {x:left,y:top};},_snap:function(x,y){var that=this,i,l,page,time,_107,_108;page=that.pagesX.length-1;for(i=0,l=that.pagesX.length;i<l;i++){if(x>=that.pagesX[i]){page=i;break;}}if(page==that.currPageX&&page>0&&that.dirX<0){page--;}x=that.pagesX[page];_107=m.abs(x-that.pagesX[that.currPageX]);_107=_107?m.abs(that.x-x)/_107*500:0;that.currPageX=page;page=that.pagesY.length-1;for(i=0;i<page;i++){if(y>=that.pagesY[i]){page=i;break;}}if(page==that.currPageY&&page>0&&that.dirY<0){page--;}y=that.pagesY[page];_108=m.abs(y-that.pagesY[that.currPageY]);_108=_108?m.abs(that.y-y)/_108*500:0;that.currPageY=page;time=m.round(m.max(_107,_108))||200;return {x:x,y:y,time:time};},_bind:function(type,el){(el||this.scroller).addEventListener(type,this,false);},_unbind:function(type,el){(el||this.scroller).removeEventListener(type,this,false);},destroy:function(){var that=this;if(that.options.checkDOMChange){clearTimeout(that.DOMChangeInterval);}if(that.pullDownToRefresh){that.pullDownEl.parentNode.removeChild(that.pullDownEl);}if(that.pullUpToRefresh){that.pullUpEl.parentNode.removeChild(that.pullUpEl);}that.hScrollbar=false;that.vScrollbar=false;that._scrollbar("h");that._scrollbar("v");that.scroller.style.webkitTransform="";that._unbind("webkitTransitionEnd");that._unbind(_c5);that._unbind(_c1);that._unbind(_c2);that._unbind(_c3);that._unbind(_c4);if(that.options.zoom){that._unbind("gesturestart");that._unbind("gesturechange");that._unbind("gestureend");that._unbind("gesturecancel");}},refresh:function(){var that=this,pos=0,page=0,i,l,els,_109,_10a,_10b;if(that.pullDownToRefresh){_10b=that.pullDownEl.className.match("loading");if(_10b&&!that.contentReady){_109=that.scrollerH;that.contentReady=true;that.pullDownEl.className="iScrollPullDown";that.pullDownLabel.innerText=that.options.pullDownLabel[0];that.offsetBottom=that.pullDownEl.offsetHeight;that.scroller.style.marginTop=-that.offsetBottom+"px";}else{if(!_10b){that.offsetBottom=that.pullDownEl.offsetHeight;that.scroller.style.marginTop=-that.offsetBottom+"px";}}}if(that.pullUpToRefresh){_10b=that.pullUpEl.className.match("loading");if(_10b&&!that.contentReady){_109=that.scrollerH;that.contentReady=true;that.pullUpEl.className="iScrollPullUp";that.pullUpLabel.innerText=that.options.pullUpLabel[0];that.offsetTop=that.pullUpEl.offsetHeight;that.scroller.style.marginBottom=-that.offsetTop+"px";}else{if(!_10b){that.offsetTop=that.pullUpEl.offsetHeight;that.scroller.style.marginBottom=-that.offsetTop+"px";}}}that.wrapperW=that.wrapper.clientWidth;that.wrapperH=that.wrapper.clientHeight;if(!that.wrapperW||!that.wrapperH){return false;}that.scrollerW=m.round(that.scroller.offsetWidth*that.scale);that.scrollerH=m.round((that.scroller.offsetHeight-that.offsetBottom-that.offsetTop)*that.scale);that.maxScrollX=that.wrapperW-that.scrollerW;that.maxScrollY=that.wrapperH-that.scrollerH;that.dirX=0;that.dirY=0;that._transitionTime(0);that.hScroll=that.options.hScroll&&that.maxScrollX<0;that.vScroll=that.options.vScroll&&(!that.options.bounceLock&&!that.hScroll||that.scrollerH>that.wrapperH);that.hScrollbar=that.hScroll&&that.options.hScrollbar;that.vScrollbar=that.vScroll&&that.options.vScrollbar&&that.scrollerH>that.wrapperH;that._scrollbar("h");that._scrollbar("v");if(typeof that.options.snap=="string"){that.pagesX=[];that.pagesY=[];els=that.scroller.querySelectorAll(that.options.snap);for(i=0,l=els.length;i<l;i++){pos=that._offset(els[i]);that.pagesX[i]=pos.x<that.maxScrollX?that.maxScrollX:pos.x*that.scale;that.pagesY[i]=pos.y<that.maxScrollY?that.maxScrollY:pos.y*that.scale;}}else{if(that.options.snap){that.pagesX=[];while(pos>=that.maxScrollX){that.pagesX[page]=pos;pos=pos-that.wrapperW;page++;}if(that.maxScrollX%that.wrapperW){that.pagesX[that.pagesX.length]=that.maxScrollX-that.pagesX[that.pagesX.length-1]+that.pagesX[that.pagesX.length-1];}pos=0;page=0;that.pagesY=[];while(pos>=that.maxScrollY){that.pagesY[page]=pos;pos=pos-that.wrapperH;page++;}if(that.maxScrollY%that.wrapperH){that.pagesY[that.pagesY.length]=that.maxScrollY-that.pagesY[that.pagesY.length-1]+that.pagesY[that.pagesY.length-1];}}}if(that.options.zoom){_10a=that._offset(that.wrapper,true);that.wrapperOffsetLeft=-_10a.x;that.wrapperOffsetTop=-_10a.y;}if(_109&&that.y==0){_109=_109-that.scrollerH+that.y;that.scrollTo(0,_109,0);}that._resetPos();},scrollTo:function(x,y,time,_10c){var that=this;if(_10c){x=that.x-x;y=that.y-y;}time=!time||(m.round(that.x)==m.round(x)&&m.round(that.y)==m.round(y))?0:time;that.moved=true;if(!that.options.HWTransition){that._timedScroll(x,y,time);return;}if(time){that._bind("webkitTransitionEnd");}that._transitionTime(time);that._pos(x,y);if(!time){setTimeout(function(){that._transitionEnd();},0);}},scrollToElement:function(el,time){var that=this,pos;el=el.nodeType?el:that.scroller.querySelector(el);if(!el){return;}pos=that._offset(el);pos.x=pos.x>0?0:pos.x<that.maxScrollX?that.maxScrollX:pos.x;pos.y=pos.y>0?0:pos.y<that.maxScrollY?that.maxScrollY:pos.y;time=time===undefined?m.max(m.abs(pos.x)*2,m.abs(pos.y)*2):time;that.scrollTo(pos.x,pos.y,time);},scrollToPage:function(_10d,_10e,time){var that=this,x,y;if(that.options.snap){_10d=_10d=="next"?that.currPageX+1:_10d=="prev"?that.currPageX-1:_10d;_10e=_10e=="next"?that.currPageY+1:_10e=="prev"?that.currPageY-1:_10e;_10d=_10d<0?0:_10d>that.pagesX.length-1?that.pagesX.length-1:_10d;_10e=_10e<0?0:_10e>that.pagesY.length-1?that.pagesY.length-1:_10e;that.currPageX=_10d;that.currPageY=_10e;x=that.pagesX[_10d];y=that.pagesY[_10e];}else{x=-that.wrapperW*_10d;y=-that.wrapperH*_10e;if(x<that.maxScrollX){x=that.maxScrollX;}if(y<that.maxScrollY){y=that.maxScrollY;}}that.scrollTo(x,y,time||400);},zoom:function(x,y,_10f,_110){var that=this,_111=_10f/that.scale;x=x-that.wrapperOffsetLeft-that.x;y=y-that.wrapperOffsetTop-that.y;that.x=x-x*_111+that.x;that.y=y-y*_111+that.y;that.scale=_10f;if(that.options.onZoomStart){that.options.onZoomStart.call(that);}that.refresh();that._bind("webkitTransitionEnd");that._transitionTime(_110!==null?_110:200);setTimeout(function(){that.zoomed=true;that.scroller.style.webkitTransform=_c7+that.x+"px,"+that.y+"px"+_c8+" scale("+_10f+")";},0);}};var _be="WebKitCSSMatrix" in window&&"m11" in new WebKitCSSMatrix(),_bf="ontouchstart" in window,_d5="ongesturestart" in window,_112="WebKitTransitionEvent" in window,_bd=(/iphone|ipad/gi).test(navigator.appVersion),_bc=(/android/gi).test(navigator.appVersion),_c5="onorientationchange" in window?"orientationchange":"resize",_c1=_bf?"touchstart":"mousedown",_c2=_bf?"touchmove":"mousemove",_c3=_bf?"touchend":"mouseup",_c4=_bf?"touchcancel":"mouseup",_c7="translate"+(_be?"3d(":"("),_c8=_be?",0)":")",m=Math;if(typeof exports!=="undefined"){exports.iScroll=_b9;}else{window.iScroll=_b9;}})();}if(!dojo._hasResource["mulberry.ui.Scrollable"]){dojo._hasResource["mulberry.ui.Scrollable"]=true;dojo.provide("mulberry.ui.Scrollable");dojo.declare("mulberry.ui.Scrollable",dijit._Widget,{postCreate:function(){this.inherited(arguments);this.subscribe("/page/transition/end","_makeScroller");this.subscribe("/window/resize","refreshScroller");this.subscribe("/fontsize","refreshScroller");this.subscribe("/content/update",function(){this.refreshScroller();if(this.scroller){this.scroller.scrollTo(0,0);}});dojo.addClass(this.domNode,"scrollable");},_makeScroller:function(){if(this.domNode.children.length>1){console.error("mulberry.ui.Scrollable::_makeScroller: More than one child element. Only the first one will be scrollable. Probably not what you want!");}this.scroller=new iScroll(this.domNode,{vScrollbar:false,onScrollStart:dojo.hitch(this,"onScrollStart"),onScrollEnd:dojo.hitch(this,"onScrollEnd")});this.scroller.refresh();},makeScroller:function(){if(!this.scroller){this._makeScroller();}},destroy:function(){if(this.scroller){this.scroller.destroy();}this.inherited(arguments);},refreshScroller:function(){if(this.scroller){this.scroller.refresh();}},onScrollStart:function(){},onScrollEnd:function(){}});}if(!dojo._hasResource["mulberry.ui.Clickable"]){dojo._hasResource["mulberry.ui.Clickable"]=true;dojo.provide("mulberry.ui.Clickable");dojo.declare("mulberry.ui.Clickable",null,{constructor:function(el,_113){this.connections=[];this.secondaryConnections=[];this.subscriptions=[];this.handler=_113;this.el=el;this.moved=false;dojo.addClass(this.el,"not-moving");if(mulberry.app.UI.hasTouch){this.connections.push(dojo.connect(el,"touchstart",this,"_onTouchStart"));this.connections.push(dojo.connect(el,"click",function(e){e.preventDefault();}));}else{this.connections.push(dojo.connect(el,"click",this,"_handle"));}},_onTouchStart:function(){this.touchStartTime=new Date().getTime();this.secondaryConnections=[dojo.connect(this.el,"touchmove",this,"_onTouchMove"),dojo.connect(this.el,"touchend",this,"_handle")];},_onTouchMove:function(){dojo.removeClass(this.el,"not-moving");this.moved=true;},_handle:function(e){this.touchEndTime=new Date().getTime();dojo.addClass(this.el,"not-moving");dojo.forEach(this.secondaryConnections||[],dojo.disconnect);this.secondaryConnections=[];if(mulberry.animating){e.preventDefault();console.log("click ignored during animation");return;}var _114=e.target,href=dojo.attr(_114,"href");if(this.touchStartTime&&(this.touchEndTime-this.touchStartTime>mulberry.app.UI.touchMoveDebounce)&&this.moved){this.moved=false;return;}while(!href&&_114!==this.el){href=dojo.attr(_114,"href");if(!href){_114=_114.parentNode;}}if(!href){return;}if(this.handler&&dojo.isFunction(this.handler)&&this.handler(_114,e)===false){return;}if(!/#/.test(href)){return;}href=href.split("#")[1];if(href){e.preventDefault();e.stopPropagation();mulberry.app.Router.go(href);}},destroy:function(){dojo.forEach(this.connections||[],dojo.disconnect);dojo.forEach(this.secondaryConnections||[],dojo.disconnect);dojo.forEach(this.subscriptions||[],dojo.unsubscribe);}});}if(!dojo._hasResource["vendor.mustache"]){dojo._hasResource["vendor.mustache"]=true;dojo.provide("vendor.mustache");var Mustache=(typeof module!=="undefined"&&module.exports)||{};(function(_115){_115.name="mustache.js";_115.version="0.5.0-dev";_115.tags=["{{","}}"];_115.parse=_116;_115.compile=_117;_115.render=_118;_115.clearCache=_119;_115.to_html=_118;var _11a=Object.prototype.toString;var _11b=Array.isArray;var _11c=Array.prototype.forEach;var _11d=String.prototype.trim;var _11e;if(_11b){_11e=_11b;}else{_11e=function(obj){return _11a.call(obj)==="[object Array]";};}var _11f;if(_11c){_11f=function(obj,_120,_121){return _11c.call(obj,_120,_121);};}else{_11f=function(obj,_122,_123){for(var i=0,len=obj.length;i<len;++i){_122.call(_123,obj[i],i,obj);}};}var _124=/^\s*$/;function _125(_126){return _124.test(_126);};var trim;if(_11d){trim=function(_127){return _127==null?"":_11d.call(_127);};}else{var _128,_129;if(_125("Â ")){_128=/^\s+/;_129=/\s+$/;}else{_128=/^[\s\xA0]+/;_129=/[\s\xA0]+$/;}trim=function(_12a){return _12a==null?"":String(_12a).replace(_128,"").replace(_129,"");};}var _12b={"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"};function _12c(_12d){return String(_12d).replace(/&(?!\w+;)|[<>"']/g,function(s){return _12b[s]||s;});};function _12e(e,_12f,line,file){file=file||"<template>";var _130=_12f.split("\n"),_131=Math.max(line-3,0),end=Math.min(_130.length,line+3),_132=_130.slice(_131,end);var c;for(var i=0,len=_132.length;i<len;++i){c=i+_131+1;_132[i]=(c===line?" >> ":"    ")+_132[i];}e.template=_12f;e.line=line;e.file=file;e.message=[file+":"+line,_132.join("\n"),"",e.message].join("\n");return e;};function _133(name,_134,_135){if(name==="."){return _134[_134.length-1];}var _136=name.split(".");var _137=_136.length-1;var _138=_136[_137];var _139,_13a,i=_134.length,j,_13b;while(i){_13b=_134.slice(0);_13a=_134[--i];j=0;while(j<_137){_13a=_13a[_136[j++]];if(_13a==null){break;}_13b.push(_13a);}if(_13a&&_138 in _13a){_139=_13a[_138];break;}}if(typeof _139==="function"){_139=_139.call(_13b[_13b.length-1]);}if(_139==null&&!_135){return "";}return _139;};function _13c(send,name,_13d,_13e,_13f){var _140=_133(name,_13e,true);if(_13f){if(_140==null||_140===false||(_11e(_140)&&_140.length===0)){send(_13d());}}else{if(_11e(_140)){_11f(_140,function(_141){_13e.push(_141);send(_13d());_13e.pop();});}else{if(typeof _140==="object"){_13e.push(_140);send(_13d());_13e.pop();}else{if(typeof _140==="function"){var _142=_13e[_13e.length-1];var _143=function(_144){return _118(_144,_142);};send(_140.call(_142,_13d(),_143)||"");}else{if(_140){send(_13d());}}}}}};function _116(_145,_146){_146=_146||{};var tags=_146.tags||_115.tags,_147=tags[0],_148=tags[tags.length-1];var code=["var line = 1;","\ntry {","\nsend(\""];var _149=[],_14a=false,_14b=false;var _14c=function(){if(_14a&&!_14b&&!_146.space){while(_149.length){code.splice(_149.pop(),1);}}else{_149=[];}_14a=false;_14b=false;};var _14d=[],_14e,_14f,_150;var _151=function(_152){tags=trim(_152).split(/\s+/);_14f=tags[0];_150=tags[tags.length-1];};var _153=function(_154){code.push("\");",_14e,"\nvar partial = partials[\""+trim(_154)+"\"];","\nif (partial) {","\n  send(render(partial, stack[stack.length - 1], partials));","\n}","\nsend(\"");};var _155=function(_156,_157){var name=trim(_156);if(name===""){throw _12e(new Error("Section name may not be empty"),_145,line,_146.file);}_14d.push({name:name,inverted:_157});code.push("\");",_14e,"\nvar name = \""+name+"\";","\nvar callback = (function () {","\n  var buffer, send = function (chunk) { buffer.push(chunk); };","\n  return function () {","\n    buffer = [];","\nsend(\"");};var _158=function(_159){_155(_159,true);};var _15a=function(_15b){var name=trim(_15b);var _15c=_14d.length!=0&&_14d[_14d.length-1].name;if(!_15c||name!=_15c){throw _12e(new Error("Section named \""+name+"\" was never opened"),_145,line,file);}var _15d=_14d.pop();code.push("\");","\n    return buffer.join(\"\");","\n  };","\n})();");if(_15d.inverted){code.push("\nsendSection(send,name,callback,stack,true);");}else{code.push("\nsendSection(send,name,callback,stack);");}code.push("\nsend(\"");};var _15e=function(_15f){code.push("\");",_14e,"\nsend(findName(\""+trim(_15f)+"\", stack));","\nsend(\"");};var _160=function(_161){code.push("\");",_14e,"\nsend(escapeHTML(findName(\""+trim(_161)+"\", stack)));","\nsend(\"");};var line=1,c,_162;for(var i=0,len=_145.length;i<len;++i){if(_145.slice(i,i+_147.length)===_147){i+=_147.length;c=_145.substr(i,1);_14e="\nline = "+line+";";_14f=_147;_150=_148;_14a=true;switch(c){case "!":i++;_162=null;break;case "=":i++;_148="="+_148;_162=_151;break;case ">":i++;_162=_153;break;case "#":i++;_162=_155;break;case "^":i++;_162=_158;break;case "/":i++;_162=_15a;break;case "{":_148="}"+_148;case "&":i++;_14b=true;_162=_15e;break;default:_14b=true;_162=_160;}var end=_145.indexOf(_148,i);if(end===-1){throw _12e(new Error("Tag \""+_147+"\" was not closed properly"),_145,line,_146.file);}var _163=_145.substring(i,end);if(_162){_162(_163);}var n=0;while(~(n=_163.indexOf("\n",n))){line++;n++;}i=end+_148.length-1;_147=_14f;_148=_150;}else{c=_145.substr(i,1);switch(c){case "\"":case "\\":_14b=true;code.push("\\"+c);break;case "\n":_149.push(code.length);code.push("\\n");_14c();line++;break;default:if(_125(c)){_149.push(code.length);}else{_14b=true;}code.push(c);}}}if(_14d.length!=0){throw _12e(new Error("Section \""+_14d[_14d.length-1].name+"\" was not closed properly"),_145,line,_146.file);}_14c();code.push("\");","\nsend(null);","\n} catch (e) { throw {error: e, line: line}; }");var body=code.join("").replace(/send\(""\);\n/g,"");if(_146.debug){if(typeof console!="undefined"&&console.log){console.log(body);}else{if(typeof print==="function"){print(body);}}}return body;};function _164(_165,_166){var args="view,partials,send,stack,findName,escapeHTML,sendSection,render";var body=_116(_165,_166);var fn=new Function(args,body);return function(view,_167,_168){if(typeof _167==="function"){_168=_167;_167={};}_167=_167||{};var _169=[];var send=_168||function(_16a){_169.push(_16a);};var _16b=[view];try{fn(view,_167,send,_16b,_133,_12c,_13c,_118);}catch(e){throw _12e(e.error,_165,e.line,_166.file);}return _169.join("");};};var _16c={};function _119(){_16c={};};function _117(_16d,_16e){_16e=_16e||{};if(_16e.cache!==false){if(!_16c[_16d]){_16c[_16d]=_164(_16d,_16e);}return _16c[_16d];}return _164(_16d,_16e);};function _118(_16f,view,_170,_171){return _117(_16f)(view,_170,_171);};})(Mustache);}if(!dojo._hasResource["mulberry._View"]){dojo._hasResource["mulberry._View"]=true;dojo.provide("mulberry._View");(function(){var _172={},_173={"haml":{firstChars:[".","%"],tmplFn:Haml},"mustache":{firstChars:["{","<"],tmplFn:function(tmpl){return dojo.partial(Mustache.render,tmpl);}}};dojo.declare("mulberry._View",[dijit._Widget,dijit._Templated,mulberry._Nls],{templateString:"%div",isHidden:false,isDisabled:false,postMixInProperties:function(){this.inherited(arguments);if(!this.device){this.device=mulberry.Device;}this.phone=this.device.type==="phone";this.tablet=this.device.type==="tablet";},_skipNodeCache:true,_stringRepl:function(tmpl){var t=_172[tmpl];if(!t){dojo.forIn(_173,function(lang,_174){if(t){return;}if(dojo.indexOf(_174.firstChars,tmpl[0])>-1){t=_172[tmpl]=_174.tmplFn(tmpl);}});}return t(this);},postCreate:function(){this.inherited(arguments);},adopt:function(cls,_175,node){var x=new cls(_175,node);this._addItem(x);return x;},_addItem:function(){this._addedItems=this._addedItems||[];this._addedItems.push.apply(this._addedItems,arguments);},orphan:function(_176,_177){this._addedItems=this._addedItems||[];var i=dojo.indexOf(this._addedItems,_176);if(i>=0){this._addedItems.splice(i,1);}if(_177){this._kill(_176);}},_kill:function(w){if(w&&w.destroyRecursive){w.destroyRecursive();}else{if(w&&w.destroy){w.destroy();}}},query:function(sel){var nl,_178;if(!sel){return new dojo.NodeList(this.domNode);}else{_178=this.domNode.querySelectorAll(sel);nl=new dojo.NodeList();dojo.forEach(_178,function(n){nl.push(n);});}return nl;},preventClickDelay:function(el,_179){this.clickables=this.clickables||[];this.clickables.push(new mulberry.ui.Clickable(el,dojo.hitch(this,_179)));},destroy:function(){dojo.forEach(this._addedItems,this._kill);dojo.forEach(this.scrollerHandles||[],function(_17a){_17a.destroy();});dojo.forEach(this.clickables||[],function(c){c.destroy();});this.inherited(arguments);},addClass:function(_17b){dojo.addClass(this.domNode,_17b);},removeClass:function(_17c){dojo.removeClass(this.domNode,_17c);},show:function(_17d){if(_17d&&_17d.nodeName){dojo.removeClass(_17d,"hidden");return;}this.removeClass("hidden");this.isHidden=false;},hide:function(_17e){if(_17e&&_17e.nodeName){dojo.addClass(_17e,"hidden");return;}this.addClass("hidden");this.isHidden=true;},toggle:function(_17f){if(_17f){dojo.toggleClass(_17f,"hidden");return;}if(this.isHidden){this.show();}else{this.hide();}},enable:function(){this.removeClass("disabled");this.isDisabled=false;},disable:function(){this.addClass("disabled");this.isDisabled=true;}});}());}if(!dojo._hasResource["mulberry.containers.Viewport"]){dojo._hasResource["mulberry.containers.Viewport"]=true;dojo.provide("mulberry.containers.Viewport");dojo.declare("mulberry.containers.Viewport",mulberry._View,{templateString:dojo.cache("mulberry.containers","Viewport/Viewport.haml","%ol.viewport\n"),direction:"next",postCreate:function(){this.connect(this.domNode,"webkitAnimationEnd","_onAnimationEnd");},_setNavDirectionAttr:function(dir){this.direction=dir==="back"?"prev":"next";},_setContentAttr:function(_180){if(mulberry.animating){return;}var n=this.domNode,next=this.direction==="next";this.direction="next";this.currentPage=_180;if(n.children.length){mulberry.animating=true;this.addClass("pre-slide");_180.placeAt(n,next?"last":"first");this.addClass(next?"slide-left":"slide-right");}else{_180.placeAt(n,"last");this._onAnimationEnd();}setTimeout(function(){if(this.animating){this._onAnimationEnd();}},600);},_cleanupOldPage:function(){var _181=document.querySelectorAll("ol.viewport > li");dojo.forEach(_181,function(page){if(this.currentPage.domNode!==page){dojo.destroy(page);var _182=dijit.byNode(page);if(_182){_182.destroy();}}},this);this.removeClass(["slide-left","slide-right","pre-slide"]);},_onAnimationEnd:function(){this._cleanupOldPage();mulberry.animating=false;dojo.publish("/page/transition/end");}});}if(!dojo._hasResource["mulberry.containers.Persistent"]){dojo._hasResource["mulberry.containers.Persistent"]=true;dojo.provide("mulberry.containers.Persistent");dojo.declare("mulberry.containers.Persistent",mulberry._View,{templateString:dojo.cache("mulberry.containers","Persistent/Persistent.haml",".container.persistent\n")});}if(!dojo._hasResource["mulberry.app.UI"]){dojo._hasResource["mulberry.app.UI"]=true;dojo.provide("mulberry.app.UI");dojo.declare("mulberry.app.UI",dojo.Stateful,{containers:{},currentPage:null,constructor:function(_183){this.device=_183;this.body=dojo.body();this.hasTouch="ontouchstart" in window;this.touchMoveDebounce=_183.os==="android"?200:0;this._containersSetup();this._watchers();this._updateViewport();this._uiSetup();this._eventSetup();},addPersistentComponent:function(_184,opts){var pc=this.containers.persistent;return pc.adopt(_184,opts||{}).placeAt(pc.domNode,"last");},_watchers:function(){var _185={fontSize:function(k,_186,_187){var b=this.body;if(_186){dojo.removeClass(b,_186);}dojo.addClass(b,_187);mulberry.app.DeviceStorage.set("fontSize",_187);dojo.publish("/fontsize");},navDirection:function(k,old,dir){this.containers.viewport.set("navDirection",dir);}};dojo.forIn(_185,this.watch,this);},_updateViewport:function(){this.viewport={width:this.body.offsetWidth,height:this.body.offsetHeight};},_uiSetup:function(){var b=this.body,_188=this.device,_189;dojo.addClass(b,_188.type);dojo.addClass(b,_188.os);dojo.addClass(b,"version-"+mulberry.app.PhoneGap.device.version);this.set("fontSize",mulberry.app.DeviceStorage.get("fontSize"));if(mulberry.isMAP){dojo.addClass(b,"layout-MAP");}},_containersSetup:function(){this.containers.viewport=new mulberry.containers.Viewport().placeAt(this.body,"first");this.containers.persistent=new mulberry.containers.Persistent().placeAt(this.body,"last");},_eventSetup:function(){dojo.connect(document,"touchmove",function(e){e.preventDefault();});dojo.connect(window,"resize",this,function(){this._updateViewport();dojo.publish("/window/resize");});dojo.connect(document,"menubutton",this,function(e){e.preventDefault();dojo.publish("/button/menu");});dojo.connect(document,"backbutton",this,function(e){e.preventDefault();mulberry.app.Router.back();});dojo.connect(document,"searchbutton",this,function(e){mulberry.app.Router.go("/search");e.preventDefault();});if(this.siblingNav){dojo.connect(this.siblingNav,"show",this,function(){dojo.addClass(this.body,"sibling-nav-visible");dojo.publish("/window/resize");});dojo.connect(this.siblingNav,"hide",this,function(){dojo.removeClass(this.body,"sibling-nav-visible");dojo.publish("/window/resize");});}},showPage:function(page,node){if(!page){throw new Error("mulberry.app.UI::showPage called without a page to show");}if(page.startup){var s=dojo.subscribe("/page/transition/end",function(){page.startup();dojo.unsubscribe(s);});}this.containers.viewport.set("content",page);this.currentPage=page;},hideSplash:function(){var _18a=dojo.byId("splash");if(_18a){dojo.destroy(_18a);}}});dojo.subscribe("/app/ready",function(){mulberry.app.UI=new mulberry.app.UI(mulberry.Device);dojo.publish("/ui/ready");mulberry.showPage=dojo.hitch(mulberry.app.UI,"showPage");});}if(!dojo._hasResource["dojo.hash"]){dojo._hasResource["dojo.hash"]=true;dojo.provide("dojo.hash");(function(){dojo.hash=function(hash,_18b){if(!arguments.length){return _18c();}if(hash.charAt(0)=="#"){hash=hash.substring(1);}if(_18b){_18d(hash);}else{location.href="#"+hash;}return hash;};var _18e,_18f,_190,_191=dojo.config.hashPollFrequency||100;function _192(str,_193){var i=str.indexOf(_193);return (i>=0)?str.substring(i+1):"";};function _18c(){return _192(location.href,"#");};function _194(){dojo.publish("/dojo/hashchange",[_18c()]);};function _195(){if(_18c()===_18e){return;}_18e=_18c();_194();};function _18d(hash){if(_18f){if(_18f.isTransitioning()){setTimeout(dojo.hitch(null,_18d,hash),_191);return;}var href=_18f.iframe.location.href;var _196=href.indexOf("?");_18f.iframe.location.replace(href.substring(0,_196)+"?"+hash);return;}location.replace("#"+hash);!_190&&_195();};function _197(){var ifr=document.createElement("iframe"),_198="dojo-hash-iframe",_199=dojo.config.dojoBlankHtmlUrl||dojo.moduleUrl("dojo","resources/blank.html");if(dojo.config.useXDomain&&!dojo.config.dojoBlankHtmlUrl){console.warn("dojo.hash: When using cross-domain Dojo builds,"+" please save dojo/resources/blank.html to your domain and set djConfig.dojoBlankHtmlUrl"+" to the path on your domain to blank.html");}ifr.id=_198;ifr.src=_199+"?"+_18c();ifr.style.display="none";document.body.appendChild(ifr);this.iframe=dojo.global[_198];var _19a,_19b,_19c,_19d,_19e,_19f=this.iframe.location;function _1a0(){_18e=_18c();_19a=_19e?_18e:_192(_19f.href,"?");_19b=false;_19c=null;};this.isTransitioning=function(){return _19b;};this.pollLocation=function(){if(!_19e){try{var _1a1=_192(_19f.href,"?");if(document.title!=_19d){_19d=this.iframe.document.title=document.title;}}catch(e){_19e=true;console.error("dojo.hash: Error adding history entry. Server unreachable.");}}var hash=_18c();if(_19b&&_18e===hash){if(_19e||_1a1===_19c){_1a0();_194();}else{setTimeout(dojo.hitch(this,this.pollLocation),0);return;}}else{if(_18e===hash&&(_19e||_19a===_1a1)){}else{if(_18e!==hash){_18e=hash;_19b=true;_19c=hash;ifr.src=_199+"?"+_19c;_19e=false;setTimeout(dojo.hitch(this,this.pollLocation),0);return;}else{if(!_19e){location.href="#"+_19f.search.substring(1);_1a0();_194();}}}}setTimeout(dojo.hitch(this,this.pollLocation),_191);};_1a0();setTimeout(dojo.hitch(this,this.pollLocation),_191);};dojo.addOnLoad(function(){if("onhashchange" in dojo.global&&(!dojo.isIE||(dojo.isIE>=8&&document.compatMode!="BackCompat"))){_190=dojo.connect(dojo.global,"onhashchange",_194);}else{if(document.addEventListener){_18e=_18c();setInterval(_195,_191);}else{if(document.attachEvent){_18f=new _197();}}}});})();}if(!dojo._hasResource["mulberry.app.Router"]){dojo._hasResource["mulberry.app.Router"]=true;dojo.provide("mulberry.app.Router");(function(d){d.declare("mulberry.app.Router",null,{QUERY_STRING_MATCHER:/\?([^#]*)$/,PATH_REPLACER:"([^/]+)",PATH_NAME_MATCHER:/:([\w\d]+)/g,_routes:[],_cache:{},_currentHash:null,_hasHistoryState:!!(history.pushState&&history.replaceState),init:function(){if(!this.defaultRoute){console.error("No default route provided to router.");throw new Error("No default route provided to router.");}var hash=window.location.hash.toString(),loc=hash.replace("#","")||this.defaultRoute.origRoute;this.go(loc);d.subscribe("/dojo/hashchange",this,"_handleHash");if(this._hasHistoryState){d.connect(window,"onpopstate",this,function(){var hash=window.location.hash.replace("#","");this._handleHash(hash);});}},go:function(loc,_1a2,_1a3){var hash=loc.replace("#",""),_1a4;if(this._hasHistoryState){history[_1a2?"replaceState":"pushState"](_1a3,null,"#"+hash);this._handleHash(hash);}else{window.location.hash=hash;this._handleHash(hash);}},back:function(){mulberry.app.UI.set("navDirection","back");history.back();},home:function(){mulberry.app.UI.set("navDirection","back");this.go("/home");},_handleHash:function(hash){if(hash===this._currentHash){console.log(">>> hash is a dupe, ignoring: "+hash);return;}this._currentHash=hash;mulberry.logSection("Handling "+hash);var _1a5=this.currentRoute=this._lookupRoute(hash),_1a6,_1a7=true;hash=hash.replace("#","");if(!_1a5){console.log("No route found for hash "+hash);this.go(this.defaultRoute.origRoute);return;}_1a6=this._parseParamsFromHash(hash);_1a6.pageState=window.history.state;_1a5=d.mixin(_1a5,{hash:hash});_1a5.callback(_1a6,_1a5);d.publish("/router/handleHash/after");mulberry.endLogSection("Handling "+hash);},_parseParamsFromHash:function(hash){var _1a8=hash.split("?"),path=_1a8[0],_1a9=_1a8[1],_1aa,_1ab,_1ac=decodeURIComponent,_1ad=this.currentRoute;_1aa=_1a9?d.mixin({},d.queryToObject(_1a9)):{};if((_1ab=_1ad.path.exec(this._routeablePath(path)))!==null){_1ab.shift();d.forEach(_1ab,function(_1ae,i){if(_1ad.paramNames[i]){_1aa[_1ad.paramNames[i]]=_1ac(_1ae);}else{if(!_1aa.splat){_1aa.splat=[];}_1aa.splat.push(_1ac(_1ae));}});}return _1aa;},_lookupRoute:function(hash){if(!this._cache[hash]){d.forEach(this._routes,function(_1af){if(this._routeablePath(hash).match(_1af.path)){this._cache[hash]=_1af;}},this);}return this._cache[hash];},_routeablePath:function(hash){return hash.replace(this.QUERY_STRING_MATCHER,"");},registerRoute:function(_1b0,fn,_1b1){var _1b2,_1b3=[],_1b4=_1b0,r;this.PATH_NAME_MATCHER.lastIndex=0;while((_1b2=this.PATH_NAME_MATCHER.exec(_1b0))!==null){_1b3.push(_1b2[1]);}_1b0=d.isString(_1b0)?new RegExp("^"+_1b0.replace(this.PATH_NAME_MATCHER,this.PATH_REPLACER)+"$"):_1b0;r={origRoute:_1b4,path:_1b0,callback:fn,paramNames:_1b3};this._routes.push(r);if(_1b1){this.defaultRoute=r;}this._cache={};}});mulberry.app.Router=new mulberry.app.Router();mulberry.route=function(_1b5,_1b6,_1b7){mulberry.app.Router.registerRoute(_1b5,_1b6,_1b7);};mulberry.routes=function(_1b8){dojo.forEach(_1b8,function(r){mulberry.app.Router.registerRoute(r.route,r.handler,r.isDefault);});};}(dojo));}if(!dojo._hasResource["mulberry.ui.BackgroundImage"]){dojo._hasResource["mulberry.ui.BackgroundImage"]=true;dojo.provide("mulberry.ui.BackgroundImage");dojo.declare("mulberry.ui.BackgroundImage",dijit._Widget,{imageUrl:"",isLoaded:false,loadOnInit:false,postCreate:function(){this.inherited(arguments);if(this.loadOnInit){this.loadImage();}},loadImage:function(){if(this.isLoaded){return;}dojo.style(this.domNode,{"backgroundImage":"url("+this.imageUrl+")","backgroundRepeat":"no-repeat"});this.isLoaded=true;},unloadImage:function(){dojo.style(this.domNode,"backgroundImage",null);this.isLoaded=false;},_setBackgroundImageAttr:function(_1b9){if(!_1b9){return;}this.imageUrl=_1b9.url;}});}if(!dojo._hasResource["mulberry.containers._LayoutBox"]){dojo._hasResource["mulberry.containers._LayoutBox"]=true;dojo.provide("mulberry.containers._LayoutBox");dojo.declare("mulberry.containers._LayoutBox",[mulberry._View,mulberry.ui.BackgroundImage],{templateString:"<div class=layout-box></div>",defaultConfig:{scrollable:false},postMixInProperties:function(){this.config=dojo.mixin(dojo.mixin({},this.defaultConfig),this.config);},postCreate:function(){this.inherited(arguments);if(this.config.className){this.addClass(this.config.className);}if(this.config.backgroundImage&&this.backgroundImage){this.loadImage();}}});}if(!dojo._hasResource["mulberry.containers.Region"]){dojo._hasResource["mulberry.containers.Region"]=true;dojo.provide("mulberry.containers.Region");(function(){mulberry.components=mulberry.components||{};var _1ba=[mulberry.components];dojo.declare("mulberry.containers.Region",mulberry.containers._LayoutBox,{templateString:dojo.cache("mulberry.containers","Region/Region.haml",".region\n  .pane{ dojoAttachPoint : 'pane' }\n    .inner{ dojoAttachPoint : 'inner' }\n"),config:{},_scroller:null,postCreate:function(){this.inherited(arguments);this._placeComponents();this._placeRegions();this._setupScroller();this.connect(this.screen,"startup","startup");},_setupScroller:function(){if(this.config.scrollable){this._scroller=new mulberry.ui.Scrollable({},this.pane);this.connect(this._scroller,"onScrollStart","onScrollStart");this.connect(this._scroller,"onScrollEnd","onScrollEnd");}},_placeComponents:function(){var _1bb=this.config.scrollable?[this.inner,"last"]:[this.pane,"replace"];if(this.config.components&&this.config.components.length>1&&_1bb[0]===this.pane){console.error("WARNING: you're trying to place more than one component into a non-scrollable region. this will end badly.");}if(this.config.components&&this.config.components.length){dojo.forEach(this.config.components,function(_1bc){var _1bd;if(_1bc.match(/^custom\./)){_1bd=client.components[_1bc.replace(/^custom\./,"")];}else{dojo.forEach(_1ba,function(ns){_1bd=ns[_1bc];});}if(!_1bd){console.error("No matching class found for",_1bc);}var c=this.adopt(_1bd,{baseObj:this.baseObj,page:this.page,node:this.baseObj,device:this.device,screen:this.screen,region:this});c.placeAt(_1bb[0],_1bb[1]);},this);}},_placeRegions:function(){var _1be=this.config.scrollable?[this.inner,"last"]:[this.domNode];if(this.config.regions&&this.config.regions.length){if(!this.config.scrollable){dojo.destroy(this.pane);}dojo.forEach(this.config.regions,function(_1bf){this.adopt(mulberry.containers.Region,{config:_1bf,baseObj:this.baseObj,device:this.device,screen:this.screen,backgroundImage:this.backgroundImage}).placeAt(_1be[0],_1be[1]);},this);}},refreshScroller:function(){if(this._scroller){this._scroller.refreshScroller();}},onScrollStart:function(){},onScrollEnd:function(){}});mulberry.registerComponentNamespace=function(ns){_1ba.push(ns);};}());}if(!dojo._hasResource["mulberry.containers.Screen"]){dojo._hasResource["mulberry.containers.Screen"]=true;dojo.provide("mulberry.containers.Screen");dojo.declare("mulberry.containers.Screen",mulberry.containers._LayoutBox,{templateString:dojo.cache("mulberry.containers","Screen/Screen.haml",".screen\n"),components:{},postCreate:function(){this.inherited(arguments);this.addClass(this.config.name);if(this.config.regions){this.regions=dojo.map(this.config.regions,function(_1c0){return this.adopt(mulberry.containers.Region,{page:this.page,config:_1c0,baseObj:this.baseObj,device:this.device,screen:this,backgroundImage:this.backgroundImage}).placeAt(this.domNode);},this);}},registerComponent:function(c){var _1c1=c.declaredClass.split("."),_1c2=_1c1[_1c1.length-1];this.components[_1c2]=c;},getComponent:function(n){n=n.replace("custom.","");return this.components[n];}});}if(!dojo._hasResource["mulberry.containers.Page"]){dojo._hasResource["mulberry.containers.Page"]=true;dojo.provide("mulberry.containers.Page");(function(){mulberry.capabilities=mulberry.capabilities||{};var _1c3=[mulberry.capabilities];dojo.declare("mulberry.containers.Page",[mulberry._View,mulberry.ui.BackgroundImage],{pageDef:{},templateString:dojo.cache("mulberry.containers","Page/Page.haml","%li.page.node.configurable\n"),postMixInProperties:function(){this.inherited(arguments);this.baseObj.shareable=this.baseObj.type==="node";},postCreate:function(){this.screens={};if(!this.baseObj){throw "mulberry.Page requires a base object";}if(!this.pageDef.screens||!this.pageDef.screens.length){throw "The config for mulberry.Page must have at least one screen defined";}var _1c4=this.baseObj.pageBackground;dojo.forEach(this.pageDef.screens,function(_1c5){var scr=this.adopt(mulberry.containers.Screen,{page:this,config:_1c5,baseObj:this.baseObj,device:this.device,backgroundImage:_1c4}).placeAt(this.domNode);this.screens[_1c5.name]=scr;},this);this.capabilities=dojo.map(this.pageDef.capabilities||[],function(_1c6){var C=dojo.isObject(_1c6)?_1c6.name:_1c6,_1c7=_1c6.components,_1c8;dojo.forEach(_1c3,function(ns){_1c8=ns[C]||_1c8;});if(!_1c8){console.warn("No capability",C,"defined in these namespaces:");dojo.forEach(_1c3,function(ns){console.log("-- namespace",ns);},this);return null;}return new _1c8({page:this,baseObj:this.baseObj,components:_1c7});},this);if(this.screens.detail){this.screens.detail.hide();}this.addClass("page-"+this.baseObj.id);this.addClass(this.pageDefName);},showScreen:function(_1c9){dojo.forIn(this.screens,function(name,_1ca){if(name!==_1c9){_1ca.hide();}});this.screens[_1c9].show();},getScreen:function(_1cb){return this.screens[_1cb];},getComponent:function(_1cc){var c=false;this._components=this._components||{};if(!this._components[_1cc]){dojo.forIn(this.screens,function(_1cd,_1ce){var tmp=_1ce.getComponent(_1cc);if(tmp){c=tmp;}});this._components[_1cc]=c;}return this._components[_1cc];},startup:function(){this.inherited(arguments);dojo.forIn(this.screens,function(name,_1cf){_1cf.startup();});},init:function(){}});mulberry.registerCapabilityNamespace=function(ns){_1c3.push(ns);};}());}if(!dojo._hasResource["mulberry.app.PageFactory"]){dojo._hasResource["mulberry.app.PageFactory"]=true;dojo.provide("mulberry.app.PageFactory");dojo.declare("mulberry.app.PageFactory",null,{constructor:function(_1d0){this.device=_1d0;},createPage:function(obj){if(!obj){throw new Error("mulberry.app.PageFactory::createPage requires an object");}var _1d1=obj.pageDef||"default",_1d2=mulberry.pageDefs[_1d1];if(!_1d2){throw ("mulberry.app.PageFactory: The page definition \""+_1d1+"\" does not exist.");}mulberry.log("Creating "+_1d1);return new mulberry.containers.Page({baseObj:obj,device:this.device,pageDef:_1d2,pageDefName:_1d1});}});dojo.subscribe("/app/ready",function(){mulberry.app.PageFactory=new mulberry.app.PageFactory(mulberry.Device);mulberry.createPage=dojo.hitch(mulberry.app.PageFactory,"createPage");});}if(!dojo._hasResource["mulberry.app.Notifications"]){dojo._hasResource["mulberry.app.Notifications"]=true;dojo.provide("mulberry.app.Notifications");(function(){var _1d3;mulberry.app.Notifications={areAvailable:function(){return !!mulberry.app.PhoneGap.present;},init:function(){if(!mulberry.app.PhoneGap.present){return;}window.plugins.pushNotification.startNotify();this._apnRegister();},setNotificationCallback:function(_1d4){if(!mulberry.app.PhoneGap.present){return;}_1d3=window.plugins.pushNotification.notificationCallback=_1d4;},notify:function(_1d5){_1d3(_1d5);},_apnRegister:function(){window.plugins.pushNotification.register(function(e){mulberry.app.Notifications._apnOnRegisterSuccess(e);},function(e){mulberry.app.Notifications._apnOnRegisterError(e);},[{alert:true,badge:true,sound:true}]);console.log("APN push notification registered.");},_apnOnRegisterSuccess:function(e){this._urbanAirshipRegister(e.deviceToken,e.host,e.appKey,e.appSecret);},_apnOnRegisterError:function(e){console.log("error registering with APN: "+e.toString());},_urbanAirshipRegister:function(_1d6,host,_1d7,_1d8){var _1d9=new XMLHttpRequest();_1d9.open("PUT",host+"api/device_tokens/"+_1d6,true,_1d7,_1d8);_1d9.onload=function(){if(this.status===200||this.status===201){console.log("Successfully registered with Urban Airship.");}else{console.log("Error when registring with Urban Airship: "+this.statusText);}};_1d9.send();}};var _1da=mulberry.app.Notifications;dojo.subscribe("/app/ready",function(){var _1db=function(){},_1dc="Notification from "+mulberry.app.Config.get("app").name;_1da.init();_1da.setNotificationCallback(function(_1dd){window.navigator.notification.alert(_1dd.alert,_1db,_1dc);});});}());}if(!dojo._hasResource["mulberry.app.Has"]){dojo._hasResource["mulberry.app.Has"]=true;dojo.provide("mulberry.app.Has");mulberry.app.Has=function(){var _1de=mulberry.Device;return {html5Player:function(){return _1de.os!=="android";},iScrollZoom:function(){return _1de.os!=="android";}};};(function(){var s=dojo.subscribe("/app/deviceready",function(){dojo.unsubscribe(s);if(dojo.isFunction(mulberry.app.Has)){mulberry.app.Has=mulberry.app.Has();}});}());}if(!dojo._hasResource["dojo.regexp"]){dojo._hasResource["dojo.regexp"]=true;dojo.provide("dojo.regexp");dojo.getObject("regexp",true,dojo);dojo.regexp.escapeString=function(str,_1df){return str.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,function(ch){if(_1df&&_1df.indexOf(ch)!=-1){return ch;}return "\\"+ch;});};dojo.regexp.buildGroupRE=function(arr,re,_1e0){if(!(arr instanceof Array)){return re(arr);}var b=[];for(var i=0;i<arr.length;i++){b.push(re(arr[i]));}return dojo.regexp.group(b.join("|"),_1e0);};dojo.regexp.group=function(_1e1,_1e2){return "("+(_1e2?"?:":"")+_1e1+")";};}if(!dojo._hasResource["dojo.cookie"]){dojo._hasResource["dojo.cookie"]=true;dojo.provide("dojo.cookie");dojo.cookie=function(name,_1e3,_1e4){var c=document.cookie;if(arguments.length==1){var _1e5=c.match(new RegExp("(?:^|; )"+dojo.regexp.escapeString(name)+"=([^;]*)"));return _1e5?decodeURIComponent(_1e5[1]):undefined;}else{_1e4=_1e4||{};var exp=_1e4.expires;if(typeof exp=="number"){var d=new Date();d.setTime(d.getTime()+exp*24*60*60*1000);exp=_1e4.expires=d;}if(exp&&exp.toUTCString){_1e4.expires=exp.toUTCString();}_1e3=encodeURIComponent(_1e3);var _1e6=name+"="+_1e3,_1e7;for(_1e7 in _1e4){_1e6+="; "+_1e7;var _1e8=_1e4[_1e7];if(_1e8!==true){_1e6+="="+_1e8;}}document.cookie=_1e6;}};dojo.cookie.isSupported=function(){if(!("cookieEnabled" in navigator)){this("__djCookieTest__","CookiesAllowed");navigator.cookieEnabled=this("__djCookieTest__")=="CookiesAllowed";if(navigator.cookieEnabled){this("__djCookieTest__","",{expires:-1});}}return navigator.cookieEnabled;};}if(!dojo._hasResource["mulberry._Component"]){dojo._hasResource["mulberry._Component"]=true;dojo.provide("mulberry._Component");dojo.declare("mulberry._Component",mulberry._View,{handleClicks:false,prepareData:function(){},setupConnections:function(){},setupSubscriptions:function(){},setupChildComponents:function(){},adjustMarkup:function(){},resizeElements:function(){},teardown:function(){},populate:function(_1e9,data){this.populateElement(this.domNode,_1e9,data);},populateElement:function(_1ea,_1eb,data){if(dojo.isString(_1ea)){_1ea=this[_1ea];}if(!_1ea){return;}_1ea.innerHTML=dojo.isArray(data)?dojo.map(data,_1eb).join(""):_1eb(data);if(this.region){this.region.refreshScroller();}},postMixInProperties:function(){this.inherited(arguments);if(this.screen){this.screen.registerComponent(this);this.connect(this.screen,"startup","startup");}this.prepareData();this._loadHelpers();this.inherited(arguments);},postCreate:function(){this.inherited(arguments);if(this.isHidden){this.hide();}if(this.handleClicks){this.preventClickDelay(this.clickableNode||this.domNode,this._clickHandler&&dojo.hitch(this,"_clickHandler"));}this.subscribe("/window/resize",function(){this.dimensions=null;});this.setupChildComponents();this.adjustMarkup();this.setupConnections();this.setupSubscriptions();},startup:function(){this.inherited(arguments);this.resizeElements();if(this.when){dojo.forIn(this.when,function(k,v){var node=this.node||this.baseObj;node[k].then(dojo.hitch(this,v));},this);}},destroy:function(){this.teardown();this.inherited(arguments);},_loadHelpers:function(){if(this.helpers&&dojo.isObject(this.helpers)){dojo.forIn(this.helpers,function(prop,tpl){if(tpl){this.helpers[prop]=Haml(tpl)();}},this);}},_setupTouch:function(ele,_1ec){var _1ed=mulberry.app.UI.hasTouch,evt=_1ed?"touchstart":"click";this.connect(ele,evt,_1ec);if(_1ed){this.connect(ele,"click",function(e){e.preventDefault();});}},getDimensions:function(){var _1ee=this[this.sizeNode];this.dimensions=this.dimensions||{width:dojo.style(this.domNode,"width"),height:dojo.style(this.domNode,"height")};return this.dimensions;}});mulberry.component=function(name,_1ef){var p=dojo.mixin(_1ef,{templateString:_1ef.componentTemplate||"%div",prepareData:function(){this.inherited(arguments);if(_1ef.prep){_1ef.prep.call(this);}},postCreate:function(){this.inherited(arguments);if(window.jQuery){this.$domNode=jQuery(this.domNode);}},startup:function(){this.inherited(arguments);if(_1ef.init){_1ef.init.call(this);}}});dojo.declare("client.components."+name,mulberry._Component,p);};}if(!dojo._hasResource["mulberry.app._Debug"]){dojo._hasResource["mulberry.app._Debug"]=true;dojo.provide("mulberry.app._Debug");(function(){var _1f0="http://api.toura.com/weinre/",sub=dojo.subscribe("/debug/user",function(_1f1){if(!confirm("Click OK if you want to enter debug mode.")){return;}mulberry.app.Router.go("/debug/"+_1f1);});var _1f2=function(){var _1f3=[],_1f4=2;while(_1f4--){_1f3.push((((1+Math.random())*65536)).toString(16).substring(0,3));}return "#m-"+_1f3.join("");};mulberry.app._Debug=function(){var _1f5=new mulberry.app._Debug.Tools().placeAt(dojo.body(),"first"),msg=new mulberry.app._Debug.Message().placeAt(dojo.body(),"first"),tpl="Debug &#64; {url} code: {hash}";dojo.connect(_1f5,"onWeinre",function(hash){msg.set("content",tpl.split("{url}").join(_1f0).split("{hash}").join(hash.slice(1)));});};mulberry.app._Debug.weinre={init:function(){var _1f6=dojo.cookie("debug-hash"),hash=_1f6||_1f2(),s=document.createElement("script"),url=s.src=this.script+hash;if(this.enabled){return hash;}window.WeinreServerURL=_1f0;document.body.appendChild(s);dojo.cookie("debug-hash",hash);this.enabled=true;return hash;},script:_1f0+"target/target-script-min.js",client:function(hash){return _1f0+"client/{hash}".replace("{hash}",hash);}};dojo.declare("mulberry.app._Debug.Tools",mulberry._Component,{templateString:"<div class=\"component debug-tools\"><div class=\"buttons\"></div></div>",actions:[{name:"Reset DB",method:"_resetDB"},{name:"weinre",method:"_weinre"}],postCreate:function(){this.inherited(arguments);this._makeActions();},_makeActions:function(){dojo.forEach(this.actions,function(_1f7){var n=dojo.create("div",{className:"button",innerHTML:_1f7.name});dojo.place(n,this.domNode.firstChild);this.connect(n,"click",_1f7.method);},this);},_resetDB:function(){mulberry.app.DeviceStorage.drop();window.location.reload();},_weinre:function(){if(this.hasWeinre){return;}var hash=mulberry.app._Debug.weinre.init();this.hasWeinre=true;this.onWeinre(hash);},onWeinre:function(hash){}});dojo.declare("mulberry.app._Debug.Message",mulberry._Component,{templateString:"<div class=\"component debug-message\"></div>",postCreate:function(){this.inherited(arguments);var n=dojo.create("div",{className:"close",innerHTML:"close"});dojo.place(n,this.domNode);this.connect(n,"click",function(){this.hide();});this.msgNode=dojo.create("div");dojo.place(this.msgNode,this.domNode);this.hide();},_setContentAttr:function(msg){this.show();this.msgNode.innerHTML=msg;}});}());}if(!dojo._hasResource["mulberry.components.Debug"]){dojo._hasResource["mulberry.components.Debug"]=true;dojo.provide("mulberry.components.Debug");(function(){var _1f8={};dojo.declare("mulberry.components.Debug",mulberry._Component,{templateString:dojo.cache("mulberry.components","Debug/Debug.haml",".component.debug\n  .status{ dojoAttachPoint : 'status' }\n\n  %table{ dojoAttachPoint : 'deviceInfo' }\n\n  %ul.actions\n    %li{ dojoAttachEvent : 'click:_weinre' } weinre\n    %li{ dojoAttachEvent : 'click:_resetDB' } reset\n\n"),prepareData:function(){var html=[],tpl=function(k,v){return "<tr><th>{k}</th><td>{v}</td></tr>".replace("{k}",k).replace("{v}",v);},_1f9=function(t){return "<tr><th colspan=2>"+t+"</th></tr>";},k;html.push(_1f9("Device"));if(window.device){dojo.forIn(window.device,function(k,v){html.push(tpl(k,v));});}html.push(tpl("UA",window.navigator.userAgent));html.push(tpl("Device Type",this.device.type));html.push(tpl("Device OS",this.device.os));var app=mulberry.app.Config.get("app");html.push(_1f9("App"));html.push(tpl("Build Date",mulberry.app.Config.get("buildDate")));html.push(tpl("Data Version",mulberry.app.Tour._getLocalVersion()));dojo.forIn(app,function(k,v){html.push(tpl(k,v));});html.push(_1f9("Features"));dojo.forIn(_1f8,function(k,v){html.push(tpl(k,v?"true":"false"));});this.info=html.join("");this.inherited(arguments);},postCreate:function(){this.inherited(arguments);this.deviceInfo.innerHTML=this.info;},_weinre:function(){this.status.innerHTML="debugging at "+mulberry.app._Debug.weinre.init();dojo.publish("/content/update");},_resetDB:function(){mulberry.app.DeviceStorage.drop();window.location.reload();}});mulberry.components.Debug.registerFeaturesObject=function(obj){dojo.mixin(_1f8,obj);};}());}if(!dojo._hasResource["mulberry.app._base"]){dojo._hasResource["mulberry.app._base"]=true;dojo.provide("mulberry.app._base");}if(!dojo._hasResource["mulberry.base"]){dojo._hasResource["mulberry.base"]=true;dojo.provide("mulberry.base");$m=mulberry;mulberry.version="0.3";var readyFn=function(){mulberry.app.DeviceStorage.init(mulberry.app.Config.get("id")||"mulberry");dojo.publish("/app/deviceready");dojo.subscribe("/app/ready",function(){mulberry.app.Router.init();mulberry.app.UI.hideSplash();});if(mulberry.features&&mulberry.features.debugToolbar){mulberry.app._Debug();}};document.addEventListener("deviceready",function(){dojo.ready(readyFn);},false);}dojo.i18n._preloadLocalizations("mulberry.nls.base",["ROOT","en","en-us","xx"]);
